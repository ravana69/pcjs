(function(){/*
 https://www.pcjs.org/machines/shared/lib/dumpapi.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/reportapi.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/userapi.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/keys.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/strlib.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/weblib.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/cpudef.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/messages.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/state.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/embed.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/defines.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/usrlib.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/component.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/defines.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/panel.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/bus.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/memory.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/cpu.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/cpustate.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/cpuops.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/chipset.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/rom.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/ram.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/keyboard.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/video.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/serial.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/shared/lib/debugger.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/debugger.js (C) 2012-2021 Jeff Parsons
 https://www.pcjs.org/machines/pcx80/lib/computer.js (C) 2012-2021 Jeff Parsons
*/
var l;function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function ba(a){if(!(a instanceof Array)){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];a=b?b.call(a):{next:aa(a)};for(var c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}
var da="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},fa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
function ha(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ja=ha(this);function ka(a,b){if(b)a:{var c=ja;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&fa(c,a,{configurable:!0,writable:!0,value:b})}}var la;
if("function"==typeof Object.setPrototypeOf)la=Object.setPrototypeOf;else{var na;a:{var oa={a:!0},pa={};try{pa.__proto__=oa;na=pa.a;break a}catch(a){}na=!1}la=na?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var qa=la;
function ra(a,b){a.prototype=da(b.prototype);a.prototype.constructor=a;if(qa)qa(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.Of=b.prototype}function sa(){for(var a=Number(this),b=[],c=a;c<arguments.length;c++)b[c-a]=arguments[c];return b}
ka("Math.trunc",function(a){return a?a:function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var c=Math.floor(Math.abs(b));return 0>b?-c:c}});
ka("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,g){this.g=f;fa(this,"description",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.g};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b});
ka("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=ja[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&fa(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ta(aa(this))}})}return a});function ta(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}
function ua(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}ka("Array.prototype.keys",function(a){return a?a:function(){return ua(this,function(b){return b})}});
var p={ze:0,Ce:1,De:2,Ee:3,Fe:4,Ge:5,He:6,Ie:7,Je:8,Ke:9,Le:10,Me:11,Ne:12,Oe:13,Pe:14,Qe:15,Re:16,Se:17,Te:18,Ue:19,Ve:20,We:21,Xe:22,Ye:23,Ze:24,$e:25,af:26,gf:27," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,$a:65,Ub:66,Vb:67,Bb:68,E:69,Xb:70,Yb:71,Zb:72,$b:73,ac:74,cc:75,Eb:76,hc:77,ic:78,mc:79,nc:80,Q:81,oc:82,qc:83,rc:84,sc:85,uc:86,
vc:87,xc:88,yc:89,ub:90,"[":91,"\\":92,"]":93,"^":94,_:95,"`":96,a:97,b:98,c:99,d:100,e:101,f:102,zd:103,Bd:104,Dd:105,Md:106,k:107,Nd:108,Pd:109,n:110,Qd:111,p:112,q:113,r:114,me:115,t:116,oe:117,pe:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126,bf:127},va={59:186,61:187,173:189,224:91};function wa(){}
function xa(a,b){if(a){b||(b=10);var c,d=0<a.indexOf(",");d&&(a=a.replace(/,/g,""));var e=c=a.charAt(0);"#"==c?(b=8,c=""):"$"==c&&(b=16,c="");e!=c?a=a.substr(1):(e=c=a.substr(0,2),"0b"==c&&d||"^B"==c?(b=2,c=""):"0o"==c||"^O"==c?(b=8,c=""):"^D"==c?(b=10,c=""):"0x"==c&&(b=16,c=""),e!=c&&(a=a.substr(2)));e=c=a.slice(-1);"Y"==c||"y"==c?(b=2,c=""):"."==c?(b=10,c=""):"H"==c||"h"==c?(b=16,c=""):"K"==c?c="000":"M"==c?c="000000":"G"==c&&(c="000000000");e!=c&&(a=a.slice(0,-1)+c);var f;e=0;10>=b&&(c=a.match(/(-?[0-9]+)B([0-9]*)/))&&
(a=c[1],e=35-((c[2]||35)&255));if((b&&10!=b?16==b?null!==a.match(/^-?[0-9a-f]+$/i):8==b?null!==a.match(/^-?[0-7]+$/):2==b&&null!==a.match(/^-?[01]+$/):null!==a.match(/^-?[0-9]+$/))&&!isNaN(f=parseInt(a,b))){e&&(0>f&&(f+=Math.pow(2,36)),f=0<e?f*Math.pow(2,e):Math.trunc(f/Math.pow(2,-e)));var g=f}}return g}
function ya(a,b,c,d,e){e=void 0===e?0:e;var f="";isNaN(a)||"number"!=typeof a?a=null:(0>a&&-1<a&&(a=-1),0>a&&(a+=Math.pow(b,c)),a>=Math.pow(b,c)&&(c=Math.ceil(Math.log(a)/Math.log(b))));for(var g=e||-1;0<c--;){g||(f=","+f,g=e);if(null==a)f="?"+f;else{var h=a%b;h+=0<=h&&9>=h?48:55;f=String.fromCharCode(h)+f;a=Math.trunc(a/b)}g--}return(void 0===d?"":d)+f}function q(a,b,c){b?9<b&&(b=9):(b=Math.abs(a),b=65535>=b?4:4294967295>=b?8:9);return ya(a,16,b,c?"0x":"")}function za(a){return q(a,2,!0)}
function v(a){return q(a,4,!0)}function Aa(a){var b=a,c=a.lastIndexOf("/");0<=c&&(b=a.substr(c+1));c=b.indexOf("&");0<c&&(b=b.substr(0,c));return b}function Ba(a){var b="",c=a.lastIndexOf(".");0<=c&&(b=a.substr(c+1).toLowerCase(),"json5"==b&&(b="json"));return b}function Da(){var a=window?window.location.hostname:"localhost";return-1!==a.indexOf("pcjs.org",a.length-8)}function Ea(a){return a.replace(/[&<>"'$]/g,function(b){return Fa[b]})}
function Ga(a,b){return(a+"                                        ").slice(0,b)}function Ha(){var a=sa.apply(0,arguments);return void 0===a[0]?new Date(Date.now()):"string"===typeof a[0]?new Date(a[0]+" "+(a[1]||"00:00:00 GMT")):void 0===a[1]?new Date(a[0]):new Date(Date.UTC.apply(Date,ba(a)))}
function Ia(a){var b=sa.apply(1,arguments);if(!b||!b.length)return a;var c="",d=a.split(/%([-+ 0#]*)([0-9]*|\*)(\.[0-9]+|)([hlL]?)([A-Za-z%])/),e=0,f;for(f=0;f<d.length-6;f+=6){c+=d[f];var g=d[f+5],h="ACDFHIMNSTWYbdfjcsoXx%".indexOf(g);if(0>h)c+="%"+d[f+1]+d[f+2]+d[f+3]+d[f+4]+g;else{if(e<b.length){var k=b[e];"%"!=g&&e++}else k=b[b.length-1];var m=d[f+1],n=0<=m.indexOf("#"),r=0<=m.indexOf("0"),u=d[f+2];"*"==u?(u=k,k=e<b.length?b[e++]:b[b.length-1]):u=+u||0;var t=d[f+3];t=t?+t.substr(1):-1;var y=null,
z=0,B="";h=12>h&&"object"!=typeof k?Ha(k):k;switch(g){case "C":k=n?"#":"";c+=isNaN(h.getTime())?void 0:Ia(Ia("%%%sW, %%%sF %%%sD, %%%sY",k),h);continue;case "D":k=n?h.getUTCDate():h.getDate();g="d";break;case "A":case "G":case "H":k=n?h.getUTCHours():h.getHours();"A"==g?(k=12>k?"am":"pm",g="s"):("G"==g&&(k=k?12<k?k-12:k:12),g="d");break;case "F":case "M":k=n?h.getUTCMonth():h.getMonth();"F"==g?(k=Ja[k],g="s"):(k++,g="d");break;case "N":k=n?h.getUTCMinutes():h.getMinutes();g="d";break;case "S":k=n?
h.getUTCSeconds():h.getSeconds();g="d";break;case "T":k=n?"#":"";c+=isNaN(h.getTime())?void 0:Ia(Ia("%%%sY-%%%s02M-%%%s02D %%%s02H:%%%s02N:%%%s02S",k),h);continue;case "W":k=Ka[n?h.getUTCDay():h.getDay()];g="s";break;case "Y":k=n?h.getUTCFullYear():h.getFullYear(),0<t&&(k%=Math.pow(10,t),t=-1),g="d"}switch(g){case "b":c+=k?"true":"false";break;case "d":k=Math.trunc(k),0<=t&&(r=!0,u<t&&(u=t),t=-1);case "f":g=k+"";0<=t&&(g=k.toFixed(t));g.length<u&&(r?(0>k&&(u--,g=g.substr(1)),g=("0000000000"+g).slice(-u),
0>k&&(g="-"+g)):g=("          "+g).slice(-u));c+=g;break;case "j":c+=JSON.stringify(k,null,u||void 0);break;case "c":k="string"==typeof k?k[0]:String.fromCharCode(k);case "s":if(void 0!=k)for("string"!=typeof k&&(k=k.toString()),0<=t&&(k=k.substr(0,t));k.length<u;)k=0<=m.indexOf("-")?k+" ":" "+k;c+=k;break;case "o":z=8,n&&(B="0");case "X":y=La;case "x":g="";z||(z=16);!B&&n&&(B="0x");y||(y=Ma);k=Math.trunc(k);0<=t&&(r=!0,u<t&&(u=t));r&&!u&&(u=Math.abs(k),u=255>=u?2:65535>=u?4:4294967295>=u?8:9,u+=
B.length);u-=B.length;do n=k&z-1,k>>>=16==z?4:3,r||!g||n||k?g=y[n]+g:(B&&(g=B+g,B=""),0<u&&(g=" "+g));while(0<--u||k);c+=B+g;break;case "%":c+="%";break;default:c+="(unimplemented printf type %"+g+")"}}}return c+=d[f]}function Na(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}
var Fa={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;",$:"&dollar;"},Qa={0:"NUL",1:"SOH",2:"STX",3:"ETX",4:"EOT",5:"ENQ",6:"ACK",7:"BEL",8:"BS",9:"TAB",10:"LF",11:"VT",12:"FF",13:"CR",14:"SO",15:"SI",16:"DLE",17:"XON",18:"DC2",19:"XOFF",20:"DC4",21:"NAK",22:"SYN",23:"ETB",24:"CAN",25:"EM",26:"SUB",27:"ESC",28:"FS",29:"GS",30:"RS",31:"US",127:"DEL"},Ma="0123456789abcdef",La="0123456789ABCDEF",Ka="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),Ja="January February March April May June July August September October November December".split(" ");
function Ra(a,b,c){var d=0,e=a.length,f=0;for(void 0===c&&(c=function(k,m){return k>m?1:k<m?-1:0});d<e;){var g=d+e>>1,h=void 0;h=c(b,a[g]);0<h?d=g+1:(e=g,f=!h)}return f?d:~d}function Sa(a,b){if(Array.prototype.indexOf)return a.indexOf(b,c);var c=c||0;0>c&&(c+=a.length);0>c&&(c=0);for(var d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1}
function Ta(a,b,c,d){function e(){if(4!==k.readyState)return null;try{g=m?k.response:k.responseText}catch(t){}if(null==g||200!=k.status&&(k.status||!g.length||"file:"!=(window?window.location.protocol:"file:")))if(f=k.status||-1,!k.status&&!Ua){var u=a.match(/(^https?:\/\/[^/]+)(.*)/);u&&(Ua=!0,w("PCjs was unable to perform a cross-origin resource request to '"+u[1]+"'.\n\nIf you're running an ad blocker, try adding '"+Va()+"' to your whitelist (or find a smarter ad blocker)."))}d&&d(a,g,f);return[g,
f]}b=void 0===b?"text":b;c=void 0===c?!1:c;var f=0,g=null,h=null;if("object"==typeof resources&&(g=resources[a]))return d&&d(a,g,f),[g,f];if(c&&"function"==typeof resources)return resources(a,function(u,t){d&&d(a,u,t)}),h;a=a.replace(/^\/(diskettes|gamedisks|harddisks|decdisks|pcsig[0-9a-z]*-disks|private)\//,"https://$1.pcjs.org/").replace(/^\/discs\/([^/]*)\//,"https://$1.pcjs.org/");var k=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),m=!1,n="string"===
typeof k.responseType;c&&(k.onreadystatechange=e);if(b&&"object"==typeof b){n="";for(var r in b)b.hasOwnProperty(r)&&(n&&(n+="&"),n+=r+"="+encodeURIComponent(b[r]));n=n.replace(/%20/g,"+");k.open("POST",a,c);k.setRequestHeader("Content-type","application/x-www-form-urlencoded");k.send(n)}else k.open("GET",a,c),"arraybuffer"==b&&(n?(m=!0,k.responseType=b):k.overrideMimeType("text/plain; charset=x-user-defined")),k.send();c||(k.readyState=4,h=e());return h}
function Wa(a,b){var c,d={ma:null,ra:null,Pa:null,Ha:null};if("["==b.charAt(0)||"{"==b.charAt(0))try{var e,f;if("<"==b.charAt(0))throw Error(b);if(0>b.indexOf("0x")&&0>b.indexOf("0o")&&'["'!=b.substr(0,2)){0>b.indexOf('"values"')&&(b=b.replace(/([a-z]+):/gm,'"$1":').replace(/\/\/[^\n]*/gm,""));var g=JSON.parse(b)}else g=eval("("+b+")");d.Pa=g.load;d.Ha=g.exec;var h=g.width,k=g.values;h&&k&&(8==h?g.bytes=k:16==h?g.words=k:32==h?g.longs=k:g.data=k);if(e=g.bytes)d.ma=e;else if(e=g.words)for(d.ma=Array(2*
e.length),f=c=0;c<e.length;c++)d.ma[f++]=e[c]&255,d.ma[f++]=e[c]>>8&255;else if(e=g.longs)for(d.ma=Array(4*e.length),f=c=0;c<e.length;c++)d.ma[f++]=e[c]&255,d.ma[f++]=e[c]>>8&255,d.ma[f++]=e[c]>>16&255,d.ma[f++]=e[c]>>24&255;else(e=g.data)?d.Lf=e:d.ma=g;d.ma&&(d.ma.length?1==d.ma.length&&(w(d.ma[0]),d=null):(w("Empty resource: "+a),d=null));d.ra=g.symbols}catch(m){w("Resource data error ("+a+"): "+m.message),d=null}else{e=[];b=b.replace(/\n/gm," ").replace(/ +$/,"").split(" ");for(c=0;c<b.length;c++){f=
parseInt(b[c],16);if(isNaN(f)){w("Resource data error ("+a+"): invalid hex byte ("+b[c]+")");break}e.push(f&255)}c==b.length&&(d.ma=e)}return d}function Va(){return window?window.location.protocol+"//"+window.location.host:"https://www.pcjs.org"}function Xa(){return window?window.navigator.userAgent:""}
function Ya(){if(null==Za){var a=!1;if(window)try{window.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a="PCjs.localStorage"==window.localStorage.getItem("PCjs.localStorage"),window.localStorage.removeItem("PCjs.localStorage")}catch(b){a=!1}Za=a}return Za}function $a(a){if(window)try{var b=window.localStorage.getItem(a)}catch(c){}return b}function ab(a,b){try{return window.localStorage.setItem(a,b),!0}catch(c){}return!1}
function bb(a){if(window){var b=Xa();return"iOS"==a&&(!!b.match(/(iPod|iPhone|iPad)/)||"MacIntel"===window.navigator.platform&&1<window.navigator.maxTouchPoints)||"MSIE"==a&&!!b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)}return!1}function gb(a,b,c){if(a)for(var d=0;d<hb.length;d++){var e=hb[d];if(c){if(e+=c,b+e in a)return e}else if(e=e?e+b[0].toUpperCase():b[0],e+=b.substr(1),e in a)return e}return null}
function ib(a){if(!jb){var b,c={};if(window){b||(b=window.location.search.substr(1));for(var d,e=/\+/g,f=/([^&=]+)=?([^&]*)/g;d=f.exec(b);)c[decodeURIComponent(d[1].replace(e," "))]=decodeURIComponent(d[2].replace(e," "))}jb=c}return jb[a]||jb[a.toLowerCase()]}function kb(a,b,c){function d(){--a;0<=a&&(b()||(a=0));0<a?setTimeout(d,0):c()}d()}
function lb(a,b){function c(){b(100===d)&&(e=setTimeout(c,d),d=100)}var d=0,e=null,f=!1;a.onmousedown=function(){f||e||(d=500,c())};a.ontouchstart=function(){e||(d=500,c())};a.onmouseup=a.onmouseout=function(){e&&(clearTimeout(e),e=null)};a.ontouchend=a.ontouchcancel=function(){e&&(clearTimeout(e),e=null);f=!0}}function mb(a,b){if(window){var c=window[a];window[a]="function"!==typeof c?b:function(){c&&c();b()}}}function nb(a){ob.init.push(a)}
function pb(a){qb(a+"\n\nIf it happens again, please send the URL to support@pcjs.org. Thanks.",void 0,void 0)}function tb(a){if(ub)try{for(var b=0;b<a.length;b++)a[b]()}catch(c){pb("An unexpected error occurred: "+c.message)}}function vb(a){!ub&&a?(ub=!0,wb&&xb("init"),yb&&xb("show")):ub=a}function xb(a){ob[a]&&tb(ob[a])}var jb=null,ob={init:[],show:[],exit:[]},hb=["","moz","ms","webkit"],wb=!1,yb=!1,ub=!0,Ua=!1,Za=null;mb("onload",function(){wb=!0;tb(ob.init)});
mb("onpageshow",function(){yb=!0;tb(ob.show)});mb(bb("iOS")?"onpagehide":bb("Opera")?"onunload":"onbeforeunload",function(){tb(ob.exit)});
function x(a,b,c){this.type=a;b||(b={id:"",name:""});this.name=b.name;this.wc=b.comment;this.Ad=b;this.id=this.id=b.id||"";this.exports={};this.R=this.bindings={};a=this.id.indexOf(".");0>a?(this.Ra="PCjs",this.Fb=this.id):(this.Ra=this.id.substr(0,a),this.Fb=this.id.substr(a+1));this.flags={ready:!1,jb:!1,Gb:!1,Mf:!1,ja:!1,Pb:!1,error:!1};this.xb=null;this.flags.error=!1;this.ha=c||0;this.L=this.B=this.J=this.S=null;zb.push(this)}function Ab(a,b,c){Bb[a]&&b&&(Bb[a][b]=c)}
function Cb(){return Date.now()||+new Date}function qb(a,b,c){b||w((c?c+": ":"")+a)}function w(a){window&&window.alert(a)}function Fb(a){var b=!1;window&&(b=window.confirm(a));return b}function Gb(a,b){a.value+=b;b=a.value;8192<b.length&&(a.value=b.substr(b.length-4096));a.scrollTop=a.scrollHeight}
function Hb(a,b){b=Ib(b.parentNode,"pcx80-control");for(var c=0;c<b.length;c++)for(var d=b[c].childNodes,e=0;e<d.length;e++){var f=d[e];if(1===f.nodeType){var g=f.getAttribute("class");if(g)for(var h=g.split(" "),k=0;k<h.length;k++)switch(g=h[k],g){case "pcx80-binding":(g=Jb(f))&&void 0!==g.binding&&a.ea(g.type,g.binding,f,g.value),k=h.length}}}}function Kb(a){var b,c=[];a&&(a=0<(b=a.indexOf("."))?a.substr(0,b+1):"");for(b=0;b<zb.length;b++){var d=zb[b];a&&d.id.indexOf(a)||c.push(d)}return c}
function Lb(a){if(void 0!==a){var b;for(b=0;b<zb.length;b++)if(zb[b].id===a)return zb[b]}return null}function Mb(a,b){var c;if(void 0!==a){var d;b&&(b=0<(d=b.indexOf("."))?b.substr(0,d+1):"");for(d=0;d<zb.length;d++)if(c)c==zb[d]&&(c=null);else if(!(a!=zb[d].type||b&&zb[d].id.indexOf(b)))return zb[d]}return null}function Jb(a){var b=null;if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(c){w(c.message+" ("+a+")")}return b}
function Ib(a,b,c){c&&(b+="-"+c+"-object");if(a.getElementsByClassName)return a.getElementsByClassName(b);var d;c=[];a=a.getElementsByTagName("*");var e=new RegExp("(^| )"+b+"( |$)");b=0;for(d=a.length;b<d;b++)e.test(a[b].className)&&c.push(a[b]);return c}
function Nb(a){for(var b=!0,c=Ob[a];c&&c.length;){var d=c.splice(0,1)[0],e=d[0],f=null;0<=Pb.indexOf(e)&&(f=function(){return function(){Nb(a)}}());var g=Qb[e];if(g)if(!f)b=g(d[1],d[2],d[3]);else{if(!g(f,d[1],d[2],d[3]))break}else{b=!1;var h=Mb(d[1],a);if(h)if(g=Sb[e])b=g(h,d[2],d[3]);else{var k=h.exports;if(k&&(g=k[e]))if(b=!0,!f)b=g.call(h,d[2],d[3]);else if(!g.call(h,f,d[2],d[3]))break}}if(!b){w("Script error: '"+e+"' command "+(g?" failed":" not recognized"));break}}c&&!c.length&&delete Ob[a];
return b}l=x.prototype;l.toString=function(){return this.name?this.name:this.id||this.type};
l.ea=function(a,b,c){switch(b){case "clear":return this.R[b]||(this.R[b]=c,c.onclick=function(d){return function(){d.R.print&&(d.R.print.value="")}}(this)),!0;case "print":return this.R[b]||(this.R[b]=c,this.ba=function(d){this.j(d,this.type);return!0},c.value="",this.print=function(d){return function(e){Gb(d,e)}}(c),this.j=function(d,e){return function(f,g){f||(f="");if(g!=Tb||"..."!=f.slice(-3))g&&(f=g+": "+f),Gb(e,f+"\n");else{g=e.value;var h=g.lastIndexOf(f);g=0>h?g+(f+"\n"):g.substr(0,h)+(f+
".")+g.substr(h+f.length);8192<g.length&&(g=g.substr(g.length-4096));e.value=g;e.scrollTop=e.scrollHeight}}}(this,c)),!0;default:return!1}};l.log=function(){};l.print=function(){};l.j=function(){};l.status=function(a){this.j(this.type+": "+Ia.apply(wa,[a].concat(ba(sa.apply(1,arguments)))))};l.ba=function(a,b,c){if(!b){var d=Mb("Computer",this.id);if(d&&d.flags.Pb)return console.log("ignoring notice during unload: "+a),!1}qb(a,b,c||this.type);return!0};function Ub(a,b){a.flags.error=!0;a.ba(b)}
function Vb(a,b){b&&(a.flags.ready?b():a.xb=b);return a.flags.ready}function Wb(a){if(!a.flags.error&&(a.flags.ready=!0,a.flags.ready)){var b=a.xb;a.xb=null;b&&b()}}function Xb(a,b){a.flags.jb&&(b?a.flags.Gb=!0:void 0===b&&a.j(a.toString()+" busy"));return a.flags.jb}function Yb(a,b){if(a.flags.Gb)return a.flags.jb=!1,a.flags.Gb=!1;if(a.flags.error)return a.j(a.toString()+" error"),!1;a.flags.jb=b;return a.flags.jb}l.va=function(){return this.flags.ja=!0};
l.ua=function(a,b){b&&(this.flags.ja=!1);return!0};function dc(a,b){b=void 0===b?0:b;if(a.L){b%2&&b--;b=b||a.ha;var c;if(!(c=-1==(b|1))){a=a.L.ha;c=Math.pow(2,32);var d=b/c|0;c=(a&b)==(b|0)&&((a/c|0)&d)==d}if(c)return!0}return!1}function ec(a,b){var c;a.L&&("boolean"==typeof c&&(c=c?-1:0),dc(a,c)&&a.L.message(b,void 0))}function A(a,b,c,d,e,f,g){a.L&&(!0===g?g=0:void 0==g&&(g=a.ha),fc(a.L,a,b,c,d,e,f,g))}var Tb="progress";
window&&(window.PCjs||(window.PCjs={}),window.PCjs.Machines||(window.PCjs.Machines={}),window.PCjs.Components||(window.PCjs.Components=[]),window.PCjs.Commands||(window.PCjs.Commands={}));
var Bb=window?window.PCjs.Machines:{},zb=window?window.PCjs.Components:[],Ob=window?window.PCjs.Commands:{},Pb=["hold","sleep","wait"],Qb={alert:function(a){w(a);return!0},sleep:function(a,b){setTimeout(a,+b);return!1}},Sb={select:function(a,b,c){var d=!1;if(a=a.bindings[b])for(b=0;b<a.options.length;b++)if(a.options[b].textContent==c){a.selectedIndex!=b&&(a.selectedIndex=b);d=!0;break}return d}};
Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){b=b||0;for(var c=this.length;b<c;b++)if(this[b]===a)return b;return-1});Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});
Function.prototype.bind||(Function.prototype.bind=function(a){function b(){return e.apply(this instanceof c&&a?this:a,d.concat(Array.prototype.slice.call(arguments)))}function c(){}if("function"!=typeof this)throw new TypeError("Function.prototype.bind: non-callable object");var d=Array.prototype.slice.call(arguments,1),e=this;c.prototype=this.prototype;b.prototype=new c;return b});
var gc="undefined"!==typeof ArrayBuffer,hc=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,
0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1],ic={cpu:2,bus:4,mem:8,port:16,nvr:32,chipset:64,keyboard:128,key:256,video:512,fdc:1024,disk:2048,serial:4096,speaker:8192,computer:16384,warn:268435456,halt:536870912,buffer:1073741824};function jc(a){x.call(this,"Panel",a)}ra(jc,x);jc.prototype.ea=function(a,b,c,d){return this.S&&this.S.ea(a,b,c,d)||this.B&&this.B.ea(a,b,c,d)||this.D&&this.D.ea(a,b,c,d)||this.L&&this.L.ea(a,b,c,d)?!0:x.prototype.ea.call(this,a,b,c,d)};
jc.prototype.Fa=function(a,b,c,d){this.S=a;this.J=b;this.B=c;this.L=d;this.D=kc(a,"Keyboard")};jc.prototype.va=function(a,b){b||lc();return!0};jc.prototype.ua=function(){return!0};function lc(){for(var a=!1,b=Ib(document,"pcx80","panel"),c=0;c<b.length;c++){var d=b[c],e=Jb(d),f=Lb(e.id);f||(a=!0,f=new jc(e));Hb(f,d);a&&Wb(f)}}nb(lc);
function mc(a,b,c){x.call(this,"Bus",a);this.B=b;this.L=c;this.N=a.busWidth||16;this.O=Math.pow(2,this.N);this.F=this.O-1|0;this.i=(this.N>>1)+2;10>this.i&&(this.i=10);15<this.i&&(this.i=15);this.A=1<<this.i;this.P=this.A>>2;this.u=this.A-1;this.K=this.O/this.A|0;this.I=this.K-1;this.C=[];this.D=[];this.G=this.H=!1;this.T=[];this.U=[];a=new C;nc(a,this.L);this.g=Array(this.K);for(b=0;b<this.K;b++)this.g[b]=a;Wb(this)}ra(mc,x);mc.prototype.reset=function(){};
mc.prototype.va=function(a,b){b||this.reset();return!0};function oc(a,b,c,d){for(var e=b,f=c,g=e>>>a.i;0<f&&g<a.g.length;){var h=a.g[g],k=g*a.A,m=a.A-(e-k);m>f&&(m=f);if(h&&h.size){if(h.type==d){if(e+f<=h.M)return h.nb+=h.M-e,h.M=e,!0;if(e>=h.M+h.nb){m=h.size-(e-k);m>f&&(m=f);h.nb=e-h.M+m;e=k+a.A;f-=m;g++;continue}}return pc(qc,e,f)}e=new C(e,m,a.A,d);nc(e,a.L,h);a.g[g++]=e;e=k+a.A;f-=m}return 0>=f?(a.status("%dKb %s at 0x%04X",Math.floor(c/1024),rc[d],b),!0):pc(sc,b,c)}
function tc(a,b){return a.g[(b&a.F)>>>a.i].mb(b&a.u,b)}function uc(a,b){var c=b&a.u,d=(b&a.F)>>>a.i;return c!=a.u?a.g[d].Ic(c,b):a.g[d++].Xa(c,b)|a.g[d&a.I].Xa(0,b+1)<<8}function vc(a,b){var c=b&a.u,d=(b&a.F)>>>a.i;return c!=a.u?a.g[d].Lb(c,b):a.g[d++].mb(c,b)|a.g[d&a.I].mb(0,b+1)<<8}function Fc(a,b,c){a.g[(b&a.F)>>>a.i].ob(b&a.u,c&255,b)}function Gc(a,b,c){var d=b&a.u,e=(b&a.F)>>>a.i;d!=a.u?a.g[e].Lc(d,c&65535,b):(a.g[e++].Za(d,c&255,b),a.g[e&a.I].Za(0,c>>8&255,b+1))}
function Hc(a,b,c,d){void 0===d&&(d=0);if(c)for(var e in c){var f=a,g=+e+d,h=c[e].bind(b);if(void 0!==h)for(var k=+e+d;k<=g;k++)void 0!==f.C[k]?w("Input port "+v(k)+" already registered"):f.C[k]=[h,!1]}}function Ic(a,b,c){for(var d=1,e=0,f=0;0<d;){var g=a.C[b],h=a.T[b]||1,k=1==h?255:2==h?65535:-1,m=k;void 0!==g?(g[0]&&(m=g[0](b,c),void 0===m?m=k:m&=k),a.L&&a.G!=g[1]&&Jc(a.L,b,m)):a.L&&(fc(a.L,a,b,null,c),a.G&&Jc(a.L,b,m));e|=m<<f;f+=h<<3;b+=h;d-=h}return e}
function Kc(a,b,c,d){void 0===d&&(d=0);if(c)for(var e in c){var f=a,g=+e+d,h=c[e].bind(b);if(void 0!==h)for(var k=+e+d;k<=g;k++)void 0!==f.D[k]?w("Output port "+v(k)+" already registered"):f.D[k]=[h,!1]}}function Lc(a,b,c,d){for(var e=1,f=0;0<e;){var g=a.D[b],h=a.U[b]||1,k=1==h?255:2==h?65535:-1,m=(c>>>=f)&k;if(void 0!==g){if(g[0])g[0](b,m,d);a.L&&a.H!=g[1]&&Mc(a.L,b,m)}else a.L&&(fc(a.L,a,b,m,d),a.H&&Mc(a.L,b,m));f+=h<<3;b+=h;e-=h}}
function pc(a,b,c){w("Memory block error ("+a+": "+q(b)+","+q(c)+")");return!1}var qc=1,sc=2,Nc;if(gc){var Oc=new ArrayBuffer(2);(new DataView(Oc)).setUint16(0,256,!0);Nc=256===(new Uint16Array(Oc))[0]}else Nc=!1;var Pc=Nc;
function C(a,b,c,d){this.id=Qc+=2;this.g=null;this.M=a;this.nb=b;this.size=c||0;this.type=d||Rc;this.B=d==Sc;nc(this);this.Ea=this.Ec=!1;if(c)if(gc)this.S=new ArrayBuffer(c),this.u=new DataView(this.S,0,c),this.i=new Uint8Array(this.S,0,c),this.A=new Uint16Array(this.S,0,c>>1),this.g=new Int32Array(this.S,0,c>>2),Tc(this,Pc?Uc:Vc);else{this.g=Array(c>>2);for(a=0;a<this.g.length;a++)this.g[a]=0;Tc(this,Wc)}else Tc(this)}l=C.prototype;
l.save=function(){var a;if(gc){var b=Array(this.size>>2);for(a=0;a<b.length;a++)b[a]=this.u.getInt32(a<<2,!0)}else b=this.g;return b};l.restore=function(a){if(a&&this.size==a.length<<2){var b;if(gc)for(b=0;b<a.length;b++)this.u.setInt32(b<<2,a[b],!0);else this.g=a;return this.Ea=!0}return!1};function Tc(a,b){b||(b=Xc);Yc(a,b,void 0);Zc(a,b,void 0)}function Yc(a,b,c){c&&a.J||(a.Xa=b[0]||a.Hc,a.Ic=b[2]||a.Jc);if(c||void 0===c)a.mb=b[0]||a.Hc,a.Lb=b[2]||a.Jc}
function Zc(a,b,c){c&&a.R||(a.Za=!a.B&&b[1]||a.pb,a.Lc=!a.B&&b[3]||a.Qb);if(c||void 0===c)a.ob=b[1]||a.pb,a.Rb=b[3]||a.Qb}l.Oa=function(a,b){b?0===this.R++&&Zc(this,$c,!1):0===this.J++&&Yc(this,$c,!1)};function ad(a,b){b?0===--a.R&&(a.Za=a.B?a.pb:a.ob,a.Lc=a.B?a.Qb:a.Rb):0===--a.J&&(a.Xa=a.mb,a.Ic=a.Lb)}function nc(a,b,c){a.L=b;a.J=a.R=0;c&&((a.J=c.J)&&Yc(a,$c,!1),(a.R=c.R)&&Zc(a,$c,!1))}l.Hc=function(){this.L&&dc(this.L,10)&&this.L.message("attempt to read invalid block %"+q(this.M),!0);return 255};
l.pb=function(a,b){this.L&&dc(this.L,10)&&this.L.message("attempt to write "+v(b)+" to invalid block %"+q(this.M),!0)};l.Jc=function(a,b){return this.Xa(a++,b++)|this.Xa(a,b)<<8};l.Qb=function(a,b,c){this.Za(a++,b&255,c++);this.Za(a,b>>8,c)};l.ge=function(a){return this.g[a>>2]>>>((a&3)<<3)&255};l.ke=function(a){var b=a>>2;a=(a&3)<<3;var c=this.g[b]>>a;return 24>a?c&65535:c&255|(this.g[b+1]&255)<<8};l.te=function(a,b){var c=a>>2;a=(a&3)<<3;this.g[c]=this.g[c]&~(255<<a)|b<<a;this.Ea=!0};
l.xe=function(a,b){var c=a>>2;a=(a&3)<<3;24>a?this.g[c]=this.g[c]&~(65535<<a)|b<<a:(this.g[c]=this.g[c]&16777215|b<<24,c++,this.g[c]=this.g[c]&-256|b>>8);this.Ea=!0};l.ee=function(a,b){if(this.L&&null!=this.M){var c=this.L;bd(c,this.M+a,1,c.O)&&cd(c,!0)}return this.mb(a,b)};l.ie=function(a,b){if(this.L&&null!=this.M){var c=this.L;bd(c,this.M+a,2,c.O)&&cd(c,!0)}return this.Lb(a,b)};
l.re=function(a,b,c){if(this.L&&null!=this.M){var d=this.L;bd(d,this.M+a,1,d.D)&&cd(d,!0)}this.B?this.pb(a,b,c):this.ob(a,b,c)};l.ve=function(a,b,c){if(this.L&&null!=this.M){var d=this.L;bd(d,this.M+a,2,d.D)&&cd(d,!0)}this.B?this.pb(a,b,c):this.Rb(a,b,c)};l.de=function(a){return this.i[a]};l.fe=function(a){return this.i[a]};l.he=function(a){return this.u.getUint16(a,!0)};l.je=function(a){return a&1?this.i[a]|this.i[a+1]<<8:this.A[a>>1]};l.qe=function(a,b){this.i[a]=b;this.Ea=!0};
l.se=function(a,b){this.i[a]=b;this.Ea=!0};l.ue=function(a,b){this.u.setUint16(a,b,!0);this.Ea=!0};l.we=function(a,b){a&1?(this.i[a]=b,this.i[a+1]=b>>8):this.A[a>>1]=b;this.Ea=!0};var Rc=0,Sc=2,rc=["NONE","RAM","ROM","VID","H/W"],Qc=0,Xc=[],Wc=[C.prototype.ge,C.prototype.te,C.prototype.ke,C.prototype.xe],$c=[C.prototype.ee,C.prototype.re,C.prototype.ie,C.prototype.ve];if(gc)var Vc=[C.prototype.de,C.prototype.qe,C.prototype.he,C.prototype.ue],Uc=[C.prototype.fe,C.prototype.se,C.prototype.je,C.prototype.we];
function dd(a,b){x.call(this,"CPU",a,2);var c=a.multiplier||1;this.za=a.cycles||b;this.U=c;this.Ta=Math.round(this.za/1E4)/100;this.aa=this.Ta*this.U;this.flags.ka=!1;this.flags.Ob=!1;this.flags.ib=a.autoStart;this.flags.Cc=!1;this.flags.Wa=!1;this.wa=this.oa=0;this.ya=a.csStart;this.na=a.csInterval;this.sa=a.csStop;this.V=[];this.vb=this.sb.bind(this);Wb(this)}ra(dd,x);l=dd.prototype;
l.Fa=function(a,b,c,d){this.S=a;this.J=b;this.L=d;for(b=0;b<ed.length;b++)(c=this.R[ed[b]])&&this.S.ea("",ed[b],c);this.X=kc(a,"ChipSet");a=fd(a,"autoStart");null!=a&&(this.flags.ib="true"==a?!0:"false"==a?!1:!!a);Wb(this)};l.reset=function(){};l.save=function(){return null};l.restore=function(){return!1};
l.va=function(a,b){if(!b){if(a&&this.restore){gd(this);if(!this.restore(a))return!1;hd(this)}else this.reset();this.L?(a=this.L,a.j("Type ? for help with PCx80 Debugger commands"),id(a),a.na&&(b=a.na,a.na=null,jd(a,b))):this.j("No debugger detected")}ud(this);return!0};l.ua=function(a){return a?this.save():!0};l.ib=function(){return this.flags.ib||!this.L&&void 0===this.R.run?(this.sb(),!0):!1};l.Fc=function(){return 0};
function hd(a){void 0===a.ya&&(a.ya=0);void 0===a.na&&(a.na=-1);void 0===a.sa&&(a.sa=-1);a.flags.Wa=0<=a.ya&&0<a.na;a.flags.Wa&&(a.wa=0,a.oa=a.ya-a.la)}function vd(a,b){if(a.flags.Wa){var c=!1;a.wa=a.wa+a.Fc()|0;a.oa-=b;0>=a.oa&&(a.oa+=a.na,c=!0);0<=a.sa&&a.sa<=wd(a)&&(a.na=a.sa=-1,hd(a),xd(a),c=!0);c&&a.j(wd(a)+" cycles: checksum="+q(a.wa))}}
l.ea=function(a,b,c){var d=this;a=!1;switch(b){case "power":case "reset":this.R[b]=c;a=!0;break;case "run":this.R[b]=c;c.onclick=function(){var e;if(e=d.S)if(e=d.S,e.flags.ja)e=!0;else{var f=null,g,h=Kb(e.id);for(g=0;g<h.length&&(f=h[g],f===e||f.flags.ready);g++);if(g==h.length)for(g=0;g<h.length&&(f=h[g],f===e||f.flags.ja);g++);g==h.length&&(f=e);w("The "+f.type+" component ("+f.id+") is not "+(f.flags.ready?"powered yet":"ready yet"+(f.xb?" (waiting for notification)":""))+".");e=!1}e&&(d.flags.ka?
xd(d):d.sb())};a=!0;break;case "speed":this.R[b]=c;a=!0;break;case "setSpeed":this.R[b]=c,c.onclick=function(){yd(d,d.U<<1,!0)},c.textContent=this.aa.toFixed(2)+"Mhz",a=!0}return a};function zd(a,b,c){a.la+=b;c&&(a.fa=a.g=0)}function Ad(a,b){var c=1;b&&1<a.U&&a.Z&&(c=a.Z/a.Ta);a.gb=Math.round(1E3/Bd);a.Ma=Math.floor(a.za/Bd*c);b||(a.ta=a.Ma);a.Va=0}function wd(a){return a.la+a.Y+a.fa-a.g}function gd(a){a.Z=0;a.hb=0;a.la=a.Y=a.fa=a.g=0;hd(a);yd(a,1)}
function yd(a,b,c){var d=!1;if(void 0!==b){.8>a.Z/a.aa?b=1:d=!0;a.U=b;b=a.Ta*a.U;if(a.aa!=b){a.aa=b;b=a.aa.toFixed(2)+"Mhz";var e=a.R.setSpeed;e&&(e.textContent=b);a.j("target speed: "+b)}c&&a.S&&a.S.Ya()}zd(a,a.Y);a.Y=0;a.W=Cb();a.ca=0;Ad(a);return d}function Cd(a,b,c){var d=void 0===d?-1:d;var e=a.V.length;a.V.push([b,-1,d,c]);0<=d&&Dd(a,e,d);return e}function Dd(a,b,c){0<=b&&b<a.V.length&&(b=a.V[b],0>b[1]&&(c=a.za*a.U/1E3*c|0,a.flags.ka&&(c+=Ed(a)),b[1]=c))}
function Ed(a,b){var c=a.fa-=a.g;a.g=0;b&&(a.fa=0);return c}
l.sb=function(a){if(Yb(this,!0)){if(!this.flags.ka){yd(this);this.S&&this.S.start(this.W,wd(this));this.flags.ka=!0;this.flags.Ob=!0;this.X&&this.X.start();var b=this.R.run;b&&(b.textContent="Halt");this.S&&(Fd(this.S,!0),a&&this.S.Ya(!0))}this.Va>=this.za&&Ad(this,!0);this.Da=0;this.La=Cb();this.ca&&(a=this.La-this.ca,a>this.gb&&(this.W+=a,this.W>this.La&&(this.W=this.La)));try{do{for(var c,d=this.flags.Wa?1:this.Ma,e=this.V.length-1;0<=e;e--){var f=this.V[e];0>f[1]||d>f[1]&&(d=f[1])}c=d;this.Cb(c);
c=Ed(this,!0);this.Da+=c;this.Y+=c;vd(this,c);a=c;for(var g=this.V.length-1;0<=g;g--){var h=this.V[g];0>h[1]||(h[1]-=a,0>=h[1]&&(h[1]=-1,h[3](),0<=h[2]&&Dd(this,g,h[2])))}this.ta-=c;if(0>=this.ta){this.ta+=this.Ma;++this.hb>=Gd&&(this.S&&Fd(this.S),this.hb=0);break}}while(this.flags.ka)}catch(k){xd(this);ud(this);this.S&&this.S.stop(Cb(),wd(this));Yb(this,!1);Ub(this,k.stack||k.message);return}c=setTimeout;d=this.vb;this.ca=Cb();e=this.gb;this.Da&&(e=Math.round(e*this.Da/this.Ma));e-=this.ca-this.La;
if(f=this.ca-this.W)this.Z=Math.round(this.Y/(10*f))/100,864E5<=f&&(this.la=0,yd(this));if(0>e||this.Z<this.aa)-1E3>e&&(this.W-=e),e=0;this.Va+=this.Da;this.ca+=e;c(d,e)}else ud(this),this.S&&this.S.stop(Cb(),wd(this))};l.Cb=function(){return 0};function xd(a,b){Xb(a,!0);Ed(a);zd(a,a.Y);a.Y=0;if(a.flags.ka){a.flags.ka=!1;a.X&&a.X.stop();var c=a.R.run;c&&(c.textContent="Run")}a.flags.complete=b}function ud(a,b){if(a.S){for(var c=a.S,d=0;d<c.C.length;d++)Hd(c.C[d],b);Fd(a.S,b)}}
var Bd=30,Gd=15,ed=["power","reset"];function Id(a){var b=+a.model||8080;dd.call(this,a,1E6);this.model=b;this.cb=Jd;gd(this);this.flags.complete=this.flags.wd=!1;this.fb=0;this.Ka=[];this.eb=0;Kd(this)}ra(Id,dd);function Ld(a,b){a.Ka.push(b)}l=Id.prototype;l.reset=function(){this.flags.ka&&xd(this);Kd(this);gd(this);this.flags.error=!1;dd.prototype.reset.call(this)};function Kd(a){a.i=0;a.A=0;a.C=0;a.D=0;a.F=0;a.G=0;a.H=0;a.N=0;D(a,a.eb);Md(a,0);a.T=0}function Nd(a,b){a.eb=b;D(a,b)}
l.Fc=function(){var a=this.i+this.A+this.C+this.D+this.F+this.G+this.H|0;return a=a+this.N+this.u+Od(this)|0};
l.save=function(){var a=new Pd(this);a.set(0,[this.i,this.A,this.C,this.D,this.F,this.G,this.H,this.N,this.u,Od(this)]);a.set(1,[this.T,this.la,this.U]);for(var b=a.set,c=this.J,d=0,e=[],f=0;f<c.K;f++){var g=c.g[f];if(g.Ea||g.Ec){e[d++]=f;var h=d++;if(g=g.save()){for(var k=0,m=0,n=[];k<g.length;){for(var r=g[k],u=k+1;u<g.length&&g[u]===r;)u++;n[m++]=u-k;n[m++]=r;k=u}n.length<g.length&&(g=n)}e[h]=g}}b.call(a,2,e);return a.data()};
l.restore=function(a){var b=a[0];this.i=b[0];this.A=b[1];this.C=b[2];this.D=b[3];this.F=b[4];this.G=b[5];this.H=b[6];this.N=b[7]&65535;D(this,b[8]);Md(this,b[9]);b=a[1];this.T=b[0];this.la=b[1];yd(this,b[3]);a:{b=this.J;a=a[2];var c;for(c=0;c<a.length-1;c+=2){var d=a[c],e=a[c+1];if(e&&e.length<b.P){var f=b.P,g=0;f=f?Array(f):[];for(var h=0;h<e.length-1;)for(var k=e[h++],m=e[h++];k--;)f[g++]=m;e=f}g=b.g[d];if(!g||!g.restore(e)){w("Unable to restore memory block "+d);b=!1;break a}}b=!0}return b};
l.ea=function(a,b,c){switch(b){case "A":case "B":case "C":case "BC":case "D":case "E":case "DE":case "H":case "L":case "HL":case "SP":case "PC":case "PS":case "IF":case "SF":case "ZF":case "AF":case "PF":case "CF":this.R[b]=c;this.fb++;a=!0;break;default:a=dd.prototype.ea.call(this,a,b,c)}return a};function Qd(a){return a.A<<8|a.C}function Rd(a,b){a.A=b>>8&255;a.C=b&255}function Sd(a){return a.D<<8|a.F}function Td(a,b){a.D=b>>8&255;a.F=b&255}function E(a){return a.G<<8|a.H}
function Ud(a,b){a.G=b>>8&255;a.H=b&255}function D(a,b){a.u=b&65535}function Vd(a){return a.I&256?1:0}function Wd(a,b){a.I=a.I&255|b}function Xd(a){return hc[a.K&255]?4:0}function Yd(a){return(a.K^a.P)&16?16:0}function Zd(a){return a.I&255?0:64}function $d(a){return a.K&128?128:0}function Od(a){return a.O&-214|$d(a)|Zd(a)|Yd(a)|Xd(a)|Vd(a)}function Md(a,b){a.I=a.K=a.P=0;b&1&&(a.I|=256);b&4||(a.K|=1);b&16&&(a.P|=16);b&64||(a.I|=255);b&128&&(a.K^=192);a.O=a.O&-726|b&512|2}
function ae(a,b){a.P=a.i^b;return a.K=(a.I=a.i+b)&255}function be(a,b){a.P=a.i^b;return a.K=(a.I=a.i+b+(a.I&256?1:0))&255}function ce(a,b){a.I=a.K=a.P=a.i&b;(a.i|b)&8&&(a.P^=16);return a.I}function de(a,b){a.P=b^255;b=a.K=b+255&255;a.I=a.I&-256|b;return b}function ee(a,b){a.P=b;b=a.K=b+1&255;a.I=a.I&-256|b;return b}function fe(a,b){return a.K=a.I=a.P=a.i|b}function ge(a,b){b^=255;a.P=a.i^b;return a.K=(a.I=a.i+b+1^256)&255}
function he(a,b){b^=255;a.P=a.i^b;return a.K=(a.I=a.i+b+(a.I&256?0:1)^256)&255}function ie(a,b){return a.K=a.I=a.P=a.i^b}function G(a,b){a=a.J;return a.g[(b&a.F)>>>a.i].Xa(b&a.u,b)}function je(a,b,c){a=a.J;a.g[(b&a.F)>>>a.i].Za(b&a.u,c&255,b)}function H(a){var b=G(a,a.u);D(a,a.u+1);return b}function I(a){var b=uc(a.J,a.u);D(a,a.u+2);return b}function ke(a){var b=uc(a.J,a.N);a.N=a.N+2&65535;return b}function J(a,b){a.N=a.N-2&65535;Gc(a.J,a.N,b)}
function le(a){if(a.g&&a.T&255&&a.O&512){for(var b=0;8>b&&!(a.T&1<<b);b++);a.T&=~(0>b?255:1<<b);a.O&=-513;a.T&=-257;a.cb[199|b<<3].call(a)}return a.T&256?(Ed(a),!1):!0}function me(a,b){a.T|=1<<b;a.O&512&&Ed(a)}function K(a,b,c,d){d=d||2;a.R[b]&&(void 0===c&&(Ub(a,"Value for "+b+" is invalid"),xd(a)),c=!a.flags.ka||a.flags.Cc?q(c,d):"--------".substr(0,d),a.R[b].textContent!=c&&(a.R[b].textContent=c))}
l.Cb=function(a){this.flags.complete=!0;var b=this.flags.wd=this.L&&ne(this.L),c=a?this.flags.Ob?0:1:-1;this.flags.Ob=!1;this.fa=this.g=a;if(le(this)){do{if(b){if(oe(this.L,this.u,c)){xd(this);break}c=1}this.cb[H(this)].call(this)}while(0<this.g)}return this.flags.complete?this.fa-this.g:void 0===this.flags.complete?0:-1};nb(function(){for(var a=Ib(document,"pcx80","cpu"),b=0;b<a.length;b++){var c=a[b],d=Jb(c);d=new Id(d);Hb(d,c)}});function pe(){this.g-=4}
function qe(){D(this,I(this));this.g-=10}function re(){D(this,ke(this));this.g-=10}function se(){var a=I(this);J(this,this.u);D(this,a);this.g-=17}
var Jd=[pe,function(){Rd(this,I(this));this.g-=10},function(){je(this,Qd(this),this.i);this.g-=7},function(){Rd(this,Qd(this)+1);this.g-=5},function(){this.A=ee(this,this.A);this.g-=5},function(){this.A=de(this,this.A);this.g-=5},function(){this.A=H(this);this.g-=7},function(){var a=this.i<<1;this.i=a&255|a>>8;Wd(this,a&256);this.g-=4},pe,function(){var a;Ud(this,a=E(this)+Qd(this));Wd(this,a>>8&256);this.g-=10},function(){this.i=G(this,Qd(this));this.g-=7},function(){Rd(this,Qd(this)-1);this.g-=
5},function(){this.C=ee(this,this.C);this.g-=5},function(){this.C=de(this,this.C);this.g-=5},function(){this.C=H(this);this.g-=7},function(){var a=this.i<<8&256;this.i=(a|this.i)>>1;Wd(this,a);this.g-=4},pe,function(){Td(this,I(this));this.g-=10},function(){je(this,Sd(this),this.i);this.g-=7},function(){Td(this,Sd(this)+1);this.g-=5},function(){this.D=ee(this,this.D);this.g-=5},function(){this.D=de(this,this.D);this.g-=5},function(){this.D=H(this);this.g-=7},function(){var a=this.i<<1;this.i=a&255|
Vd(this);Wd(this,a&256);this.g-=4},pe,function(){var a;Ud(this,a=E(this)+Sd(this));Wd(this,a>>8&256);this.g-=10},function(){this.i=G(this,Sd(this));this.g-=7},function(){Td(this,Sd(this)-1);this.g-=5},function(){this.F=ee(this,this.F);this.g-=5},function(){this.F=de(this,this.F);this.g-=5},function(){this.F=H(this);this.g-=7},function(){var a=this.i<<8;this.i=(Vd(this)<<8|this.i)>>1;Wd(this,a&256);this.g-=4},pe,function(){Ud(this,I(this));this.g-=10},function(){var a=I(this);Gc(this.J,a,E(this));
this.g-=16},function(){Ud(this,E(this)+1);this.g-=5},function(){this.G=ee(this,this.G);this.g-=5},function(){this.G=de(this,this.G);this.g-=5},function(){this.G=H(this);this.g-=7},function(){var a=0,b=Vd(this);if(Yd(this)||9<(this.i&15))a|=6;if(b||154<=this.i)a|=96,b=1;this.i=ae(this,a);Wd(this,b?256:0);this.g-=4},pe,function(){var a;Ud(this,a=E(this)+E(this));Wd(this,a>>8&256);this.g-=10},function(){var a=I(this);a=uc(this.J,a);Ud(this,a);this.g-=16},function(){Ud(this,E(this)-1);this.g-=5},function(){this.H=
ee(this,this.H);this.g-=5},function(){this.H=de(this,this.H);this.g-=5},function(){this.H=H(this);this.g-=7},function(){this.i=~this.i&255;this.g-=4},pe,function(){this.N=I(this)&65535;this.g-=10},function(){je(this,I(this),this.i);this.g-=13},function(){this.N=this.N+1&65535;this.g-=5},function(){var a=E(this);je(this,a,ee(this,G(this,a)));this.g-=10},function(){var a=E(this);je(this,a,de(this,G(this,a)));this.g-=10},function(){je(this,E(this),H(this));this.g-=10},function(){this.I|=256;this.g-=
4},pe,function(){var a;Ud(this,a=E(this)+this.N);Wd(this,a>>8&256);this.g-=10},function(){this.i=G(this,I(this));this.g-=13},function(){this.N=this.N-1&65535;this.g-=5},function(){this.i=ee(this,this.i);this.g-=5},function(){this.i=de(this,this.i);this.g-=5},function(){this.i=H(this);this.g-=7},function(){Wd(this,Vd(this)?0:256);this.g-=4},function(){this.g-=5},function(){this.A=this.C;this.g-=5},function(){this.A=this.D;this.g-=5},function(){this.A=this.F;this.g-=5},function(){this.A=this.G;this.g-=
5},function(){this.A=this.H;this.g-=5},function(){this.A=G(this,E(this));this.g-=7},function(){this.A=this.i;this.g-=5},function(){this.C=this.A;this.g-=5},function(){this.g-=5},function(){this.C=this.D;this.g-=5},function(){this.C=this.F;this.g-=5},function(){this.C=this.G;this.g-=5},function(){this.C=this.H;this.g-=5},function(){this.C=G(this,E(this));this.g-=7},function(){this.C=this.i;this.g-=5},function(){this.D=this.A;this.g-=5},function(){this.D=this.C;this.g-=5},function(){this.g-=5},function(){this.D=
this.F;this.g-=5},function(){this.D=this.G;this.g-=5},function(){this.D=this.H;this.g-=5},function(){this.D=G(this,E(this));this.g-=7},function(){this.D=this.i;this.g-=5},function(){this.F=this.A;this.g-=5},function(){this.F=this.C;this.g-=5},function(){this.F=this.D;this.g-=5},function(){this.g-=5},function(){this.F=this.G;this.g-=5},function(){this.F=this.H;this.g-=5},function(){this.F=G(this,E(this));this.g-=7},function(){this.F=this.i;this.g-=5},function(){this.G=this.A;this.g-=5},function(){this.G=
this.C;this.g-=5},function(){this.G=this.D;this.g-=5},function(){this.G=this.F;this.g-=5},function(){this.g-=5},function(){this.G=this.H;this.g-=5},function(){this.G=G(this,E(this));this.g-=7},function(){this.G=this.i;this.g-=5},function(){this.H=this.A;this.g-=5},function(){this.H=this.C;this.g-=5},function(){this.H=this.D;this.g-=5},function(){this.H=this.F;this.g-=5},function(){this.H=this.G;this.g-=5},function(){this.g-=5},function(){this.H=G(this,E(this));this.g-=7},function(){this.H=this.i;
this.g-=5},function(){je(this,E(this),this.A);this.g-=7},function(){je(this,E(this),this.C);this.g-=7},function(){je(this,E(this),this.D);this.g-=7},function(){je(this,E(this),this.F);this.g-=7},function(){je(this,E(this),this.G);this.g-=7},function(){je(this,E(this),this.H);this.g-=7},function(){var a=this.u-1;if(this.Ka.length)for(var b=0;b<this.Ka.length;b++)if(this.Ka[b](a))return;this.g-=7;this.T|=256;Ed(this);this.L&&dc(this,536870912)?(D(this,a),cd(this.L)):this.O&512||(this.L&&D(this,a),xd(this))},
function(){je(this,E(this),this.i);this.g-=7},function(){this.i=this.A;this.g-=5},function(){this.i=this.C;this.g-=5},function(){this.i=this.D;this.g-=5},function(){this.i=this.F;this.g-=5},function(){this.i=this.G;this.g-=5},function(){this.i=this.H;this.g-=5},function(){this.i=G(this,E(this));this.g-=7},function(){this.g-=5},function(){this.i=ae(this,this.A);this.g-=4},function(){this.i=ae(this,this.C);this.g-=4},function(){this.i=ae(this,this.D);this.g-=4},function(){this.i=ae(this,this.F);this.g-=
4},function(){this.i=ae(this,this.G);this.g-=4},function(){this.i=ae(this,this.H);this.g-=4},function(){this.i=ae(this,G(this,E(this)));this.g-=7},function(){this.i=ae(this,this.i);this.g-=4},function(){this.i=be(this,this.A);this.g-=4},function(){this.i=be(this,this.C);this.g-=4},function(){this.i=be(this,this.D);this.g-=4},function(){this.i=be(this,this.F);this.g-=4},function(){this.i=be(this,this.G);this.g-=4},function(){this.i=be(this,this.H);this.g-=4},function(){this.i=be(this,G(this,E(this)));
this.g-=7},function(){this.i=be(this,this.i);this.g-=4},function(){this.i=ge(this,this.A);this.g-=4},function(){this.i=ge(this,this.C);this.g-=4},function(){this.i=ge(this,this.D);this.g-=4},function(){this.i=ge(this,this.F);this.g-=4},function(){this.i=ge(this,this.G);this.g-=4},function(){this.i=ge(this,this.H);this.g-=4},function(){this.i=ge(this,G(this,E(this)));this.g-=7},function(){this.i=ge(this,this.i);this.g-=4},function(){this.i=he(this,this.A);this.g-=4},function(){this.i=he(this,this.C);
this.g-=4},function(){this.i=he(this,this.D);this.g-=4},function(){this.i=he(this,this.F);this.g-=4},function(){this.i=he(this,this.G);this.g-=4},function(){this.i=he(this,this.H);this.g-=4},function(){this.i=he(this,G(this,E(this)));this.g-=7},function(){this.i=he(this,this.i);this.g-=4},function(){this.i=ce(this,this.A);this.g-=4},function(){this.i=ce(this,this.C);this.g-=4},function(){this.i=ce(this,this.D);this.g-=4},function(){this.i=ce(this,this.F);this.g-=4},function(){this.i=ce(this,this.G);
this.g-=4},function(){this.i=ce(this,this.H);this.g-=4},function(){this.i=ce(this,G(this,E(this)));this.g-=7},function(){this.i=ce(this,this.i);this.g-=4},function(){this.i=ie(this,this.A);this.g-=4},function(){this.i=ie(this,this.C);this.g-=4},function(){this.i=ie(this,this.D);this.g-=4},function(){this.i=ie(this,this.F);this.g-=4},function(){this.i=ie(this,this.G);this.g-=4},function(){this.i=ie(this,this.H);this.g-=4},function(){this.i=ie(this,G(this,E(this)));this.g-=7},function(){this.i=ie(this,
this.i);this.g-=4},function(){this.i=fe(this,this.A);this.g-=4},function(){this.i=fe(this,this.C);this.g-=4},function(){this.i=fe(this,this.D);this.g-=4},function(){this.i=fe(this,this.F);this.g-=4},function(){this.i=fe(this,this.G);this.g-=4},function(){this.i=fe(this,this.H);this.g-=4},function(){this.i=fe(this,G(this,E(this)));this.g-=7},function(){this.i=fe(this,this.i);this.g-=4},function(){ge(this,this.A);this.g-=4},function(){ge(this,this.C);this.g-=4},function(){ge(this,this.D);this.g-=4},
function(){ge(this,this.F);this.g-=4},function(){ge(this,this.G);this.g-=4},function(){ge(this,this.H);this.g-=4},function(){ge(this,G(this,E(this)));this.g-=7},function(){ge(this,this.i);this.g-=4},function(){Zd(this)||(D(this,ke(this)),this.g-=6);this.g-=5},function(){Rd(this,ke(this));this.g-=10},function(){var a=I(this);Zd(this)||D(this,a);this.g-=10},qe,function(){var a=I(this);Zd(this)||(J(this,this.u),D(this,a),this.g-=6);this.g-=11},function(){J(this,Qd(this));this.g-=11},function(){this.i=
ae(this,H(this));this.g-=7},function(){J(this,this.u);D(this,0);this.g-=11},function(){Zd(this)&&(D(this,ke(this)),this.g-=6);this.g-=5},re,function(){var a=I(this);Zd(this)&&D(this,a);this.g-=10},qe,function(){var a=I(this);Zd(this)&&(J(this,this.u),D(this,a),this.g-=6);this.g-=11},se,function(){this.i=be(this,H(this));this.g-=7},function(){J(this,this.u);D(this,8);this.g-=11},function(){Vd(this)||(D(this,ke(this)),this.g-=6);this.g-=5},function(){Td(this,ke(this));this.g-=10},function(){var a=I(this);
Vd(this)||D(this,a);this.g-=10},function(){var a=H(this);Lc(this.J,a,this.i,this.u+-2&65535);this.g-=10},function(){var a=I(this);Vd(this)||(J(this,this.u),D(this,a),this.g-=6);this.g-=11},function(){J(this,Sd(this));this.g-=11},function(){this.i=ge(this,H(this));this.g-=7},function(){J(this,this.u);D(this,16);this.g-=11},function(){Vd(this)&&(D(this,ke(this)),this.g-=6);this.g-=5},re,function(){var a=I(this);Vd(this)&&D(this,a);this.g-=10},function(){var a=H(this);this.i=Ic(this.J,a,this.u+-2&65535)&
255;this.g-=10},function(){var a=I(this);Vd(this)&&(J(this,this.u),D(this,a),this.g-=6);this.g-=11},se,function(){this.i=he(this,H(this));this.g-=7},function(){J(this,this.u);D(this,24);this.g-=11},function(){Xd(this)||(D(this,ke(this)),this.g-=6);this.g-=5},function(){Ud(this,ke(this));this.g-=10},function(){var a=I(this);Xd(this)||D(this,a);this.g-=10},function(){var a=ke(this);J(this,E(this));Ud(this,a);this.g-=18},function(){var a=I(this);Xd(this)||(J(this,this.u),D(this,a),this.g-=6);this.g-=
11},function(){J(this,E(this));this.g-=11},function(){this.i=ce(this,H(this));this.g-=7},function(){J(this,this.u);D(this,32);this.g-=11},function(){Xd(this)&&(D(this,ke(this)),this.g-=6);this.g-=5},function(){D(this,E(this));this.g-=5},function(){var a=I(this);Xd(this)&&D(this,a);this.g-=10},function(){var a=E(this);Ud(this,Sd(this));Td(this,a);this.g-=5},function(){var a=I(this);Xd(this)&&(J(this,this.u),D(this,a),this.g-=6);this.g-=11},se,function(){this.i=ie(this,H(this));this.g-=7},function(){J(this,
this.u);D(this,40);this.g-=11},function(){$d(this)||(D(this,ke(this)),this.g-=6);this.g-=5},function(){var a=ke(this);Md(this,a&255|this.O&-256);this.i=a>>8;this.g-=10},function(){var a=I(this);$d(this)||D(this,a);this.g-=10},function(){this.O&=-513;this.g-=4},function(){var a=I(this);$d(this)||(J(this,this.u),D(this,a),this.g-=6);this.g-=11},function(){J(this,Od(this)&255|this.i<<8);this.g-=11},function(){this.i=fe(this,H(this));this.g-=7},function(){J(this,this.u);D(this,48);this.g-=11},function(){$d(this)&&
(D(this,ke(this)),this.g-=6);this.g-=5},function(){this.N=E(this)&65535;this.g-=5},function(){var a=I(this);$d(this)&&D(this,a);this.g-=10},function(){this.O|=512;this.g-=4;le(this)},function(){var a=I(this);$d(this)&&(J(this,this.u),D(this,a),this.g-=6);this.g-=11},se,function(){ge(this,H(this));this.g-=7},function(){J(this,this.u);D(this,56);this.g-=11}];
function te(a){x.call(this,"ChipSet",a,64);var b=a.model;b&&!ue[b]&&qb("Unrecognized ChipSet model: "+b);this.i=ue[b]||{};a.sound&&(this.V=null,window&&(this.V=window.AudioContext||window.webkitAudioContext),this.V&&new this.V);Wb(this)}ra(te,x);l=te.prototype;l.ea=function(){return!1};
l.Fa=function(a,b,c,d){this.J=b;this.B=c;this.L=d;this.S=a;this.D=kc(a,"Keyboard");this.F=kc(a,"SerialPort");this.video=kc(a,"Video");Hc(b,this,this.i.zb);Kc(b,this,this.i.Ab);if(d){var e=this;Re(d,32,function(){for(var f="",g=0;g<e.u.length;g++)f&&(f+=g&&g%10?", ":",\n"),f+=v(e.u[g]);e.L.j(f)})}};l.va=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};l.ua=function(a){return a?this.save():!0};l.reset=function(){this.i.INIT&&!this.restore(this.i.INIT)&&this.ba("reset error")};
l.save=function(){var a=new Pd(this);switch(this.i.pa){case Se.pa:a.set(0,[this.ca,this.C,this.fa,this.O,this.U,this.Z,this.aa]);break;case L.pa:a.set(0,[this.X,this.G]),a.set(1,[this.H,this.I]),a.set(2,[this.A,this.P,this.Y,this.W]),a.set(3,[this.N,this.g,this.K,this.T,this.u])}return a.data()};
l.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.i.pa){case Se.pa:return this.ca=b[0],this.C=b[1],this.fa=b[2],this.O=b[3],this.U=b[4],this.Z=b[5],this.aa=b[6],!0;case L.pa:return this.X=b[0],this.G=b[1],b=a[1],this.H=b[0],this.I=b[1],b=a[2],this.A=b[0],this.P=b[1],this.Y=b[2],this.W=b[3],b=a[3],this.N=b[0],this.g=b[1],this.K=b[2],this.T=b[3],this.u=b[4],!0}return!1};l.start=function(){};l.stop=function(){};l.Hd=function(a,b){var c=this.ca;A(this,a,void 0,b,"STATUS0",c,!0);return c};
l.Id=function(a,b){var c=this.C;A(this,a,void 0,b,"STATUS1",c,!0);return c};l.Jd=function(a,b){var c=this.fa;A(this,a,void 0,b,"STATUS2",c,!0);return c};l.Gd=function(a,b){var c=this.O>>8-this.U&255;A(this,a,void 0,b,"SHIFT.RESULT",c,!0);return c};l.Ud=function(a,b,c){A(this,a,b,c,"SHIFT.COUNT",void 0,!0);this.U=b};l.Wd=function(a,b,c){A(this,a,b,c,"SOUND1",void 0,!0);this.Z=b};l.Vd=function(a,b,c){A(this,a,b,c,"SHIFT.DATA",void 0,!0);this.O=b<<8|this.O>>8};
l.Xd=function(a,b,c){A(this,a,b,c,"SOUND2",void 0,!0);this.aa=b};l.Yd=function(a,b,c){A(this,a,b,c,"WATCHDOG",void 0,!0)};function Te(a){var b=0,c=0,d=~a.N;for(a=0;10>a;a++)d&1&&(b=9-a),d>>=1;for(a=0;10>a;a++)d&1&&(c=9-a),d>>=1;return 10*b+c}
l.Kd=function(a,b){var c=this.G;c&=~L.xa.kc;if((wd(this.B)&64)<<1&&(c|=L.xa.kc,c!=this.G)){var d=this.K&1;var e=this.K>>1&7;switch(e){case L.Aa.Ia.od:break;case L.Aa.Ia.Mc:this.N=this.N<<1|d;break;case L.Aa.Ia.Rc:d=Te(this);this.u[d]=L.Aa.tb;ec(this,"doNVRCommand(): erase data at addr "+v(d));break;case L.Aa.Ia.Nc:this.g=this.g<<1|d;break;case L.Aa.Ia.sd:d=Te(this);e=this.g&L.Aa.tb;this.u[d]=e;ec(this,"doNVRCommand(): write data "+v(e)+" to addr "+v(d));break;case L.Aa.Ia.md:d=Te(this);e=this.u[d];
null==e&&(e=L.Aa.tb);this.g=e;ec(this,"doNVRCommand():  read data "+v(e)+" from addr "+v(d));break;case L.Aa.Ia.nd:this.g<<=1;this.T=this.g&L.Aa.tb+1;break;default:ec(this,"doNVRCommand(): unrecognized command "+za(e))}}c&=~L.xa.lc;this.T&&(c|=L.xa.lc);c&=~L.xa.dc;if(d=this.D){d=this.D;if(e=d.C)e=d.B,e=wd(d.B)>=d.H+(e.za*e.U/1E3*1.2731488|0);e&&(d.C=!1);d=!d.C}d&&(c|=L.xa.dc);c&=~L.xa.tc;this.F&&this.F.ia&Ue&&(c|=L.xa.tc);this.G=c;A(this,a,void 0,b,"FLAGS",c);return c};
l.Zd=function(a,b,c){A(this,a,b,c,"BRIGHTNESS");this.X=b};l.be=function(a,b,c){A(this,a,b,c,"NVR.LATCH");this.K=b};l.ae=function(a,b,c){A(this,a,b,c,"DC012");a=b&3;switch(b>>2&3){case 0:this.A=this.A&-4|a;break;case 1:this.A=this.A&-13|a<<2;this.video&&(b=this.video,a=this.A,ec(b,"updateScrollOffset("+a+")"),b.sa!==a&&((b.sa=a)?Hd(b,!0):b.wa=!0));break;case 2:switch(a){case 0:this.P=~this.P;break;case 2:case 3:this.Y=3-a}break;case 3:this.W=a}};
l.$d=function(a,b,c){A(this,a,b,c,"DC011");b&L.Ja.ld?(b&=L.Ja.pc,this.I!=b&&(this.I=b,this.video&&(a=this.video,b=this.I==L.Ja.pc?50:60,ec(a,"updateRate("+b+")"),a.hb=b))):(b&=L.Ja.Wb,this.H!=b&&(this.H=b,this.video&&(a=this.H==L.Ja.Wb?132:80,b=this.video,ec(b,"updateDimensions("+a+","+(80<a&&this.G&L.xa.jc?14:24)+")"),b.P=a,b.ga=b.Da,80<a&&b.ga--,Ve(b)&&We(b))))};
var Se={pa:1978.1,qd:{qa:0,df:1,jf:16,rf:32,Af:64,zf:128,ab:14},Na:{qa:1,Qc:1,kd:2,fd:4,gd:16,hd:32,jd:64,ab:8},rd:{qa:2,cf:3,If:4,ef:8,vf:16,wf:32,xf:64,ff:128,ab:0},Ef:{qa:3},Cf:{qa:2,sf:7},Gf:{qa:3,Jf:1,Ff:2,yf:4,pf:8,hf:16,ye:32},Df:{qa:4},Hf:{qa:5,kf:1,lf:2,mf:4,nf:8,Kf:16}},L={pa:100,xa:{qa:66,tc:1,jc:2,ed:4,uf:8,tf:16,lc:32,kc:64,dc:128},Pc:{qa:66,INIT:0},Ja:{qa:194,Be:0,Wb:16,ld:32,pc:48,Uc:0,Vc:32},rb:{qa:162,Bf:0,Xc:0,Tc:0,Wc:0,Sc:0},Aa:{qf:{qa:98},Ia:{Nc:0,Mc:1,nd:2,sd:4,Rc:5,md:6,od:7},
tb:16383}},ue={SI1978:Se,VT100:L};Se.INIT=[[Se.qd.ab,Se.Na.ab,Se.rd.ab,0,0,0,0]];
L.INIT=[[L.Pc.INIT,L.xa.jc|L.xa.ed],[L.Ja.Uc,L.Ja.Vc],[L.rb.Xc,L.rb.Tc,L.rb.Wc,L.rb.Sc],[0,0,0,0,[11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11776,11784,11918,11776,11984,11888,11776,11808,11776,12E3,12E3,11901,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11776,11784,11918,11808,11984,11856,11776,11808,11776,12E3,12E3,11881,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]];Se.zb={0:te.prototype.Hd,1:te.prototype.Id,2:te.prototype.Jd,3:te.prototype.Gd};
Se.Ab={2:te.prototype.Ud,3:te.prototype.Wd,4:te.prototype.Vd,5:te.prototype.Xd,6:te.prototype.Yd};L.zb={66:te.prototype.Kd};L.Ab={66:te.prototype.Zd,98:te.prototype.be,162:te.prototype.ae,194:te.prototype.$d};nb(function(){for(var a=Ib(document,"pcx80","chipset"),b=0;b<a.length;b++){var c=a[b],d=Jb(c);d=new te(d);Hb(d,c)}});
function Xe(a){x.call(this,"ROM",a);this.g=null;this.C=a.addr;this.i=a.size;this.A=a.alias;this.u=a.file;this.D=Aa(this.u);if(this.u){a=this.u;var b=Ba(this.D);"json"!=b&&"hex"!=b&&(a=Va()+"/api/v1/dump?file="+this.u+"&format=bytes&decimal=true");var c=this;Ta(a,null,!0,function(d,e,f){Ye(c,d,e,f)})}}ra(Xe,x);Xe.prototype.Fa=function(a,b,c,d){this.J=b;this.B=c;this.L=d;Ze(this)};
Xe.prototype.va=function(){if(this.ra){if(this.L){var a=this.L,b=this.id,c=this.C,d=this.i,e=this.ra,f=[],g;for(g in e){var h=e[g];"number"==typeof h&&(e[g]=h={o:h});var k=h.o,m=h.a;if(void 0!==k){var n=f;k=[k>>>0,g];var r=Ra(n,k,a.Bc);0>r&&n.splice(-(r+1),0,k)}m&&(h.a=m.replace(/''/g,'"'))}a.F.push({Nf:b,M:c,Od:d,ra:e,zc:f})}delete this.ra}return!0};Xe.prototype.ua=function(){return!0};
function Ye(a,b,c,d){if(d)a.ba("Unable to load system ROM (error "+d+": "+b+")");else{Ab(a.Ra,b,c);if("["==c.charAt(0)||"{"==c.charAt(0))try{var e=eval("("+c+")"),f=e.bytes,g=e.longs||e.data;if(f)a.g=f;else if(g)for(a.g=Array(4*g.length),d=c=0;c<g.length;c++)a.g[d++]=g[c]&255,a.g[d++]=g[c]>>8&255,a.g[d++]=g[c]>>16&255,a.g[d++]=g[c]>>24&255;else a.g=e;a.ra=e.symbols;if(!a.g.length){w("Empty ROM: "+b);return}if(1==a.g.length){w(a.g[0]);return}}catch(h){a.ba("ROM data error: "+h.message);return}else for(b=
c.replace(/\n/gm," ").replace(/ +$/,"").split(" "),a.g=Array(b.length),e=0;e<b.length;e++)a.g[e]=xa(b[e],16);Ze(a)}}
function Ze(a){if(!Vb(a))if(!a.u)Wb(a);else if(a.g&&a.J){a.i||(a.i=a.g.length);if(a.g.length!=a.i)Ub(a,"ROM size ("+q(a.g.length,8,!0)+") does not match specified size ("+q(a.i,8,!0)+")");else{var b=a.C;if(oc(a.J,b,a.i,Sc)){var c;for(c=0;c<a.g.length;c++)Fc(a.J,b+c,a.g[c]);b=!0}else b=!1;if(b){b=[];"number"==typeof a.A?b.push(a.A):null!=a.A&&a.A.length&&(b=a.A);for(c=0;c<b.length;c++){for(var d=a,e=b[c],f=d.J,g=d.i,h=[],k=d.C>>>f.i;0<g&&k<f.g.length;)h.push(f.g[k++]),g-=f.A;f=d.J;d=d.i;g=0;for(e>>>=
f.i;0<d&&e<f.g.length;){k=h[g++];if(!k)break;f.g[e++]=k;d-=f.A}}delete a.g}}Wb(a)}}nb(function(){for(var a=Ib(document,"pcx80","rom"),b=0;b<a.length;b++){var c=a[b],d=Jb(c);d=new Xe(d);Hb(d,c)}});
function $e(a){x.call(this,"RAM",a);this.ra=this.i=null;this.A=a.addr;this.C=a.size;this.Pa=a.load;this.Ha=a.exec;this.u=!1;this.g=a.file;this.D=Aa(this.g);if(this.g){a=this.g;var b=Ba(this.D);"json"!=b&&"hex"!=b&&(a=Va()+"/api/v1/dump?file="+this.g+"&format=bytes&decimal=true");var c=this;Ta(a,null,!0,function(d,e,f){f?c.ba("Unable to load RAM resource (error "+f+": "+d+")"):(Ab(c.Ra,d,e),(d=Wa(d,e))?(c.i=d.ma,c.ra=d.ra,null==c.Pa&&(c.Pa=d.Pa),null==c.Ha&&(c.Ha=d.Ha)):c.g=null,af(c))})}}ra($e,x);
$e.prototype.Fa=function(a,b,c,d){this.J=b;this.B=c;this.L=d;af(this)};$e.prototype.va=function(){return!0};$e.prototype.ua=function(){return!0};
function af(a){!a.u&&a.C&&oc(a.J,a.A,a.C,1)&&(a.u=!0);if(!Vb(a)){if(!a.u)w("No RAM allocated");else if(a.g){if(!a.i||!a.J)return;var b=a.A;null!==a.Pa&&(b=a.Pa);for(var c=0;c<a.i.length;c++)Fc(a.J,b+c,a.i[c]);if(null!==a.Ha){if(a.Ha==bf){for(c=0;c<cf.length;c++)Fc(a.J,cf[c],118);Ld(a.B,function(d){return function(e){if(0<=cf.indexOf(e)){var f=!1,g=d.B,h=d.L;if(e==df)switch(f=!0,g.C){case ef:d.print(String.fromCharCode(g.F).replace(/\r/g,""));break;case ff:for(var k=Sd(g),m="",n=255;n--;){var r=G(d.B,
k++);if(36==r)break;m+=String.fromCharCode(r)}d.print(m.replace(/\r/g,""));break;default:f=!1}f?re.call(g):h&&(d.j("\nCP/M vector "+v(e)),D(g,e),cd(h));e=!0}else e=!1;return e}}(a))}Nd(a.B,a.Ha)}delete a.i}Wb(a)}}$e.prototype.reset=function(){};var df=5,ef=2,ff=9,bf=256,cf=[0,df];nb(function(){for(var a=Ib(document,"pcx80","ram"),b=0;b<a.length;b++){var c=a[b],d=Jb(c);d=new $e(d);Hb(d,c)}});
function gf(a){x.call(this,"Keyboard",a,128);(a=a.model)&&!hf[a]&&qb("Unrecognized KeyboardX80 model: "+a);this.g=hf[a]||{};this.reset();Wb(this)}ra(gf,x);l=gf.prototype;
l.ea=function(a,b,c){var d=this,e=a+"-"+b;if(void 0===this.R[e]){if("led"==a&&this.g.bb[b])return this.R[e]=c,!0;switch(b){case "kbd":case "screen":return bb("iOS")?(c.onkeypress=function(f){var g=!1;if(f=d.g.qb[f.keyCode||f.charCode]){f&128&&(f&=127,g=!0);a:{for(h in d.g.Sa)if(d.g.Sa[h]==f){var h=+h;break a}h=0}h&&(g?jf(d,16,!0,!0):jf(d,16,!1),jf(d,h,!0,!0))}return!0},c.onkeydown=function(f){return kf(d,f,!0)},c.onkeyup=function(f){return kf(d,f,!1)}):(c.onkeydown=function(f){return lf(d,f,!0)},
c.onkeyup=function(f){return lf(d,f,!1)},c.onkeypress=function(f){f=f.keyCode||f.charCode;f>=p.$a&&f<=p.ub?d.i&(mf|nf)||(d.i|=nf,jf(d,20,!0),of(d)):f>=p.a&&f<=p.z&&d.i&nf&&(d.i&=~nf,jf(d,20,!1),of(d));return!0}),c.onpaste=function(f){a:{if(d.F&&d.F.Qa&&(f.stopPropagation&&f.stopPropagation(),f.preventDefault&&f.preventDefault(),f=f.clipboardData||window.clipboardData)){pf(d.F,f.getData("Text"));f=!1;break a}f=!0}return f},!0;default:if(this.g.Ua&&void 0!==this.g.Ua[b])return this.R[e]=c,c.onclick=
function(f,g){return function(h){h.preventDefault&&h.preventDefault();h=!0;var k=0;17==g?k=qf:20==g&&(k=nf);if(k){c.style.fontWeight="normal";if(h=!(f.i&k))c.style.fontWeight="bold";rf(f,g,h)}jf(f,g,h,!k);f.S&&f.S.Ya()}}(this,this.g.Ua[b]),!0}}return!1};l.Fa=function(a,b,c,d){this.S=a;this.B=c;this.L=d;var e=this;this.K=Cd(this.B,this.id,function(){sf(e)});this.X=kc(a,"ChipSet");this.F=kc(a,"SerialPort");Hc(b,this,this.g.zb);Kc(b,this,this.g.Ab)};
l.va=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};l.ua=function(a){return a?this.save():!0};l.reset=function(){this.u=[];this.i=0;this.g.INIT&&!this.restore(this.g.INIT)&&this.ba("reset error")};l.save=function(){var a=new Pd(this);switch(this.g.pa){case M.pa:a.set(0,[this.G,this.D,this.C,this.H,-1])}return a.data()};
l.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.g.pa){case tf.pa:return!0;case M.pa:return this.G=b[0],of(this,this.G&M.Ba.ec),this.D=b[1],this.C=b[2],this.H=b[3],this.A=b[4],!0}return!1};function of(a,b){null!=b?a.I=b:b=a.I;for(var c in a.g.bb){var d="led-"+c;if(d=a.R[d]){var e=a.g.bb[c],f=!!(b&e);e&e-1&&(f=!(b&~e));d.style.backgroundColor=f?"#"+q(16711680,6):"#000000"}}if(d=a.R["led-caps-lock"])d.style.backgroundColor=a.i&nf?"#"+q(65280,6):"#000000"}
function rf(a,b,c,d){var e=0;switch(b){case 16:e=d?uf:vf;break;case 17:e=d?wf:qf;break;case 18:e=d?xf:yf;break;case 91:e=d?zf:Af;break;case 20:e=nf,c=!(a.i&e)}e&&(a.i=c?a.i|e:a.i&~e);return c}
function lf(a,b,c){var d=!0,e=b.keyCode;e=va[e]||e;c=rf(a,e,c,2==b.location);a:if(e=a.g.Tb[e]||e,a.g.Sa[e])var f=e;else{for(f in a.g.Ua)if(a.g.Ua[f]===e)break a;f=null}f&&!b.metaKey&&(d=!1,a.i&(Bf|Cf)&&(13==f?(f=118,d=!0):8==f&&(f=46,d=!0),d&&(a.i=c?a.i|Cf:a.i&~Cf)),d=jf(a,f,c),(!(f>=p.$a&&f<=p.ub)||a.i|Df)&&b.preventDefault&&b.preventDefault());return d}
function kf(a,b,c){var d=!0;if(c){var e=b.keyCode,f=a.g.Sa[e],g;if(g=f){a:{for(var h in a.g.qb)if(a.g.qb[h]==f){f=+h;break a}f=0}g=!f}g&&(d=jf(a,e,c,!0),b.preventDefault&&b.preventDefault())}return d}
function jf(a,b,c,d){var e;a:{for(e=0;e<a.u.length;e++)if(a.u[e].Nb==b)break a;e=-1}if(c)0>e?a.u.push({Nb:b,Kb:Date.now(),wb:d||!1}):(a.u[e].Kb=Date.now(),a.u[e].wb=d||!1),d&&sf(a);else if(0<=e){if(!a.u[e].wb&&(d=a.u[e].Kb)&&Date.now()-d<Ef)return a.u[e].wb=!0,sf(a),!0;a.u.splice(e,1)}if(a.X){d=0;switch(b){case "1p":d=Se.Na.fd;break;case "2p":d=Se.Na.kd;break;case "coin":d=Se.Na.Qc;break;case "left":d=Se.Na.hd;break;case "right":d=Se.Na.jd;break;case "fire":d=Se.Na.gd}d&&(a=a.X,b=d,a.C&=~b,c&&(a.C|=
b))}return!0}function sf(a){for(var b=0,c=-1;b<a.u.length;){if(a.u[b].wb){var d=a.u[b].Nb,e=Ef-(Date.now()-a.u[b].Kb);if(0<e){if(0>c||c>e)c=e}else{jf(a,d,!1);b=0;continue}}b++}0<=c&&Dd(a.B,a.K,c)}l.Ld=function(a,b){var c=this.D;0<=this.A&&(this.A<this.u.length?(c=this.u[this.A],this.A++,c=M.Sa[c.Nb],c&128&&(c&=127)):(this.A=-1,c=M.Zc),this.D=c,me(this.B,1));A(this,a,void 0,b,"KBDUART.ADDRESS",c);return c};
l.ce=function(a,b,c){A(this,a,b,c,"KBDUART.STATUS");this.G=b;this.C=!0;this.H=wd(this.B);of(this,b&M.Ba.ec);b&M.Ba.pd&&(this.A=0,me(this.B,1))};var uf=1,vf=2,mf=3,wf=4,qf=8,Df=12,xf=16,yf=32,Bf=48,zf=64,Af=128,nf=512,Cf=4096,Ef=50,Ff={};Ff[p.$a]=37;Ff[p.Bb]=39;Ff[p.Eb]=32;
var tf={pa:1978.1,Sa:{},qb:{},Tb:Ff,bb:{},Ua:{"1p":49,"2p":50,coin:51,left:37,right:39,fire:32}},N={},O={},M={pa:100,Sa:(N[8]=3,N[p.nc]=5,N[p.mc]=6,N[p.yc]=7,N[p.rc]=8,N[p.vc]=9,N[p.Q]=10,N[39]=16,N[221]=20,N[219]=21,N[p.$b]=22,N[p.sc]=23,N[p.oc]=24,N[p.E]=25,N[49]=26,N[37]=32,N[40]=34,N[117]=35,N[19]=35,N[192]=36,N[189]=37,N[57]=38,N[55]=39,N[52]=40,N[51]=41,N[27]=42,N[38]=48,N[114]=49,N[112]=50,N[46]=51,N[187]=52,N[48]=53,N[56]=54,N[54]=55,N[53]=56,N[50]=57,N[9]=58,N[103]=64,N[115]=65,N[113]=66,
N[96]=67,N[118]=68,N[220]=69,N[p.Eb]=70,N[p.cc]=71,N[p.Yb]=72,N[p.Xb]=73,N[p.$a]=74,N[104]=80,N[2013]=81,N[98]=82,N[97]=83,N[222]=85,N[186]=86,N[p.ac]=87,N[p.Zb]=88,N[p.Bb]=89,N[p.qc]=90,N[110]=96,N[116]=97,N[101]=98,N[100]=99,N[13]=100,N[190]=101,N[188]=102,N[p.ic]=103,N[p.Ub]=104,N[p.xc]=105,N[119]=106,N[105]=112,N[99]=113,N[102]=114,N[109]=115,N[191]=117,N[p.hc]=118,N[p[" "]]=119,N[p.uc]=120,N[p.Vb]=121,N[p.ub]=122,N[120]=123,N[17]=124,N[16]=125,N[20]=126,N),qb:(O[p.p]=5,O[p.Qd]=6,O[p.y]=7,O[p.t]=
8,O[p.w]=9,O[p.q]=10,O[p["]"]]=20,O[p["["]]=21,O[p.Dd]=22,O[p.oe]=23,O[p.r]=24,O[p.e]=25,O[p["1"]]=26,O[p["`"]]=36,O[p["-"]]=37,O[p["9"]]=38,O[p["7"]]=39,O[p["4"]]=40,O[p["3"]]=41,O[p["="]]=52,O[p["0"]]=53,O[p["8"]]=54,O[p["6"]]=55,O[p["5"]]=56,O[p["2"]]=57,O[p["\\"]]=69,O[p.Nd]=70,O[p.k]=71,O[p.zd]=72,O[p.f]=73,O[p.a]=74,O[p["'"]]=85,O[p[";"]]=86,O[p.Md]=87,O[p.Bd]=88,O[p.d]=89,O[p.me]=90,O[13]=100,O[p["."]]=101,O[p[","]]=102,O[p.n]=103,O[p.b]=104,O[p.x]=105,O[p["/"]]=117,O[p.Pd]=118,O[p.pe]=120,
O[p.c]=121,O[p.z]=122,O[p.nc]=133,O[p.mc]=134,O[p.yc]=135,O[p.rc]=136,O[p.vc]=137,O[p.Q]=138,O[p["}"]]=148,O[p["{"]]=149,O[p.$b]=150,O[p.sc]=151,O[p.oc]=152,O[p.E]=153,O[p["!"]]=154,O[p["~"]]=164,O[p._]=165,O[p["("]]=166,O[p["&"]]=167,O[p.$]=168,O[p["#"]]=169,O[p["+"]]=180,O[p[")"]]=181,O[p["*"]]=182,O[p["^"]]=183,O[p["%"]]=184,O[p["@"]]=185,O[p["|"]]=197,O[p.Eb]=198,O[p.cc]=199,O[p.Yb]=200,O[p.Xb]=201,O[p.$a]=202,O[p['"']]=213,O[p[":"]]=214,O[p.ac]=215,O[p.Zb]=216,O[p.Bb]=217,O[p.qc]=218,O[p[">"]]=
229,O[p["<"]]=230,O[p.ic]=231,O[p.Ub]=232,O[p.xc]=233,O[p["?"]]=245,O[p.hc]=246,O[p.uc]=248,O[p.Vb]=249,O[p.ub]=250,O),Tb:{},bb:{},Ua:{"caps-lock":20,ctrl:17,esc:27,tab:9,"num-comma":116,"break":117,"line-feed":118,"no-scroll":119,setup:120},Oc:{qa:130,INIT:127},Ba:{qa:130,cd:1,bd:2,ad:4,$c:8,dd:16,fc:32,ec:63,pd:64,Ae:128,INIT:0},Zc:127};M.bb={l4:M.Ba.cd,l3:M.Ba.bd,l2:M.Ba.ad,l1:M.Ba.$c,locked:M.Ba.dd,local:M.Ba.fc,online:~M.Ba.fc,"caps-lock":nf};var hf={SI1978:tf,VT100:M};
M.INIT=[[M.Ba.INIT,M.Oc.INIT,!1,0,-1]];M.zb={130:gf.prototype.Ld};M.Ab={130:gf.prototype.ce};nb(function(){for(var a=Ib(document,"pcx80","keyboard"),b=0;b<a.length;b++){var c=a[b],d=Jb(c);d=new gf(d);Hb(d,c)}});
function Gf(a,b,c,d,e){x.call(this,"Video",a,512);var f=this;this.Ta=bb("Gecko/");this.N=a.screenWidth;this.I=a.screenHeight;this.la=a.bufferAddr;this.xd=a.bufferRAM;var g=a.bufferFormat;this.Z=g&&Hf[g.toUpperCase()]||If;this.P=a.bufferCols;this.aa=a.bufferRows;this.Da=this.ga=a.cellWidth||1;this.da=a.cellHeight||1;this.ca=null;this.Ma=!1;this.na=a.bufferBits||1;this.yd=a.bufferLeft||0;if(this.i=a.bufferRotate)this.i=this.i%360,0<this.i&&(this.i-=360),-90!=this.i&&(this.ba("unsupported buffer rotation: "+
this.i),this.i=0);this.oa=a.interruptRate;this.vb=a.refreshRate||60;this.H=b;this.u=c;this.W=(this.Cd=d)||b||null;this.ud=this.N;this.vd=this.I;this.Ka=this.N/this.P|0;this.La=this.I/this.aa|0;1<this.da&&(this.aa++,this.sa=0,this.wa=!1);b=a.smoothing;(c=ib("smoothing"))&&(b="true"==c);this.Va=b;this.Sb=gb(this.u,"imageSmoothingEnabled");if(this.A=a.screenRotate)this.A=this.A%360,0<this.A&&(this.A-=360),-90!=this.A?(this.ba("unsupported screen rotation: "+this.A),this.A=0):(this.u.translate(0,this.I),
this.u.rotate(this.A*Math.PI/180),this.u.scale(this.I/this.N,this.N/this.I));if(this.g=e)if(b=gb(e,"requestFullscreen")||gb(e,"requestFullScreen")){this.g.kb=e[b];if(e=gb(document,"on","fullscreenchange")){var h=gb(document,"fullscreenElement")||gb(document,"fullScreenElement");document.addEventListener(e,function(){Jf(f,null!=document[h])},!1)}(e=gb(document,"on","fullscreenerror"))&&document.addEventListener(e,function(){Jf(f)},!1)}if(this.T=a.fontROM)"json"!=Ba(this.T)&&(this.T=Va()+"/api/v1/dump?file="+
this.T+"&format=bytes"),Ta(this.T,null,!0,function(k,m,n){Kf(f,k,m,n)});this.za={}}ra(Gf,x);
function Ve(a){a.F=a.P*a.ga;a.O=a.aa*a.da;var b=a.F,c=a.O;a.i&&(b=a.O,c=a.F);a.K=0;if(!a.xd&&(a.K=(a.F*a.na>>3)*a.O,!oc(a.J,a.la,a.K,3)))return!1;a.K?(a.cb=a.u.createImageData(b,c),a.fb=16/a.na|0,Lf(a,a.K>>1)):Lf(a,(a.P+1)*a.aa);a.G=document.createElement("canvas");a.G.width=b;a.G.height=c;a.ta=a.G.getContext("2d");a.U={};a.Y=1<<a.na;a.V=Array(a.Y+Mf);a.V[0]=[0,0,0,255];a.V[1]=[255,255,255,255];a.Z==Nf&&(a.V[a.Y+Of]=[255,255,0,255],a.V[a.Y+Pf]=[0,255,0,255]);a.Z==Qf&&(a.hb=60,a.ya=!1,a.fa=Array(a.P));
a.Sb&&(a.u[a.Sb]=null==a.Va?!1:a.Va);return!0}l=Gf.prototype;l.ea=function(a,b,c){var d=this;if("led"==a||"rled"==a)return this.za[b]=c,!0;switch(b){case "fullScreen":return this.R[b]=c,this.g&&this.g.kb?c.onclick=function(){d.kb()}:c.parentNode.removeChild(c),!0}return!1};
l.Fa=function(a,b,c,d){this.S=a;this.J=b;this.B=c;this.L=d;Ve(this);if(this.D=kc(a,"Keyboard")){for(var e in this.za)this.D.ea("led",e,this.za[e]);this.H&&this.D.ea(this.Cd?"textarea":"canvas","screen",this.W)}var f=this;this.Ac=Cd(this.B,this.id,function(){Hd(f)});Dd(this.B,this.Ac,1E3/Math.max(this.vb,this.oa));this.gb=0;this.T||Wb(this)};
function Kf(a,b,c,d){if(d)a.ba("Unable to load font ROM (error "+d+": "+b+")");else{Ab(a.Ra,b,c);try{var e=eval("("+c+")"),f=e.bytes||e;if(!f||!f.length){w("Empty font ROM: "+b);return}if(1==f.length){w(f[0]);return}if(2048==f.length)a.ca=f,We(a);else{a.ba("Unrecognized font data length ("+f.length+")");return}}catch(g){a.ba("Font ROM data error: "+g.message);return}(a.u||a.L)&&Wb(a)}}
function We(a){a.ca&&(a.Ma=a.Z==Qf,a.U[Rf]=[Sf(a,a.ga,a.da),Sf(a,a.ga,a.da,a.ya)],a.U[Tf]=[Sf(a,2*a.ga,a.da),Sf(a,2*a.ga,a.da,a.ya)],a.U[Uf]=a.U[Vf]=[Sf(a,2*a.ga,2*a.da),Sf(a,2*a.ga,2*a.da,a.ya)])}
function Sf(a,b,c,d){var e=8>=a.Da?8:16,f=8<e?15:0,g=a.ca.length/e,h=!1===d,k={ga:b,da:c};k.canvas=document.createElement("canvas");k.canvas.width=16*b;k.canvas.height=g/16*c;k.context=k.canvas.getContext("2d");for(var m=k.context.createImageData(b,c),n=0;n<g;n++){for(var r=0,u=r;r<a.da;r++){var t=n*e+(f+r&e-1);t=d&&8==r?255:a.ca[t];for(var y=0;y<c/a.da;y++){for(var z=0,B=0,ea=B;B<a.ga;B++){var F=t&128>>(7<B?7:B);z=a.Ma&&!F&&z?z:F;for(var ma=0;ma<b/a.ga;ma++)h&&(z=!z),Wf(a,m,ea,u,z?1:0),ea++;z=F}u++}}k.context.putImageData(m,
(n&15)*b,(n>>4)*c)}return k}l.va=function(a,b){return b||!a||this.restore(a)?!0:!1};l.ua=function(a){return!a||this.save()};l.save=function(){var a=new Pd(this);a.set(0,[]);return a.data()};l.restore=function(){return!0};
l.kb=function(){var a=!1;if(this.g){if(this.g.kb){a="100%";if(screen&&screen.width&&screen.height){var b=screen.width/screen.height,c=this.N/this.I;b>c&&(a=Math.round(c/b*100)+"%")}this.Ta?(this.H.style.width=a,this.H.style.width=a,this.H.style.display="block",this.H.style.margin="auto"):(this.g.style.width=a,this.g.style.height="auto");this.g.style.backgroundColor="black";this.g.kb();a=!0}this.W&&this.W.focus()}return a};
function Jf(a,b){!b&&a.g&&(a.Ta?a.H.style.width=a.H.style.height="":a.g.style.width=a.g.style.height="");ec(a,"notifyFullScreen("+b+")")}function Lf(a,b){a.eb=b;a.X=!1;if(void 0===a.C||a.C.length!=a.eb)a.C=Array(a.eb)}function Wf(a,b,c,d,e){d=a.i?(b.height-c-1)*b.width+d:c+d*b.width;e&&a.Z==Nf&&(208<=c&&236>c?e=a.Y+Of:28<=c&&72>c&&(e=a.Y+Pf));a=a.V[e];d*=a.length;b.data[d]=a[0];b.data[d+1]=a[1];b.data[d+2]=a[2];b.data[d+3]=a[3]}
function Hd(a,b){var c=!0;if(!b){a.oa&&(120==a.oa?a.gb&1?(me(a.B,2),c=!1):me(a.B,1):me(a.B,4));if(c&&a.X&&a.K){var d=a.J,e=a.la,f=a.K,g=!0,h=e>>>d.i;for(e=d.A-(e&d.u);0<f&&h<d.g.length;)d.g[h].Ea&&(d.g[h].Ea=g=!1,d.g[h].Ec=!0),f-=e,e=d.A,h++;g&&(c=!1)}Dd(a.B,a.Ac,1E3/Math.max(a.vb,a.oa));a.gb++}if(c)if(1<a.ga)switch(a.Z){case Qf:c=a.la;d=-1;f=0;g=60==a.hb?2:5;e=h=0;for(var k=-1;f<a.aa;){var m=0,n=c,r=d,u=a.P;for(r!=Rf&&(u>>=1);;){var t=tc(a.J,n++);if((t&Xf)==Xf){var y=tc(a.J,n++);d=y&Yf;c=(y&Zf)<<
8|tc(a.J,n);c+=y&$f?ag:bg;break}if(m<u)a.fa[m++]=t;else break}if(g)g--;else{for(;m<a.fa.length;)a.fa[m++]=0;if(0<=r)for(n=a.X&&a.C[h]==u,a.C[h++]=u,u=0;u<m;u++){t=a.fa[u];if(!n||t!==a.C[h]){a.C[k=h]=t;y=a;var z=a.ta;var B=t&127;if(t=y.U[r][t&128?1:0]){var ea=(B&15)*t.ga,F=(B>>4)*t.da,ma=t.ga,T=t.da;if(z){var ia=u*y.ga;var Oa=f*y.da;var Rb=y.ga;B=y.da}else ia=u*y.Ka,Oa=f*y.La,Rb=y.Ka,B=y.La;t.ga>y.ga&&(ia*=2,Rb*=2);t.da>y.da&&(r==Vf&&(F+=y.da),T=y.da);z?z.drawImage(t.canvas,ea,F,ma,T,ia,Oa,Rb,B):y.u.drawImage(t.canvas,
ea,F,ma,T,ia,Oa,Rb,B)}e++}h++}f++}}a.X=!0;!b&&a.wa&&1==e&&(a.C[k]=-1,e=0);a.wa=!1;(e||b)&&a.ta&&a.u.drawImage(a.G,0,a.sa,a.F,a.O-a.da,0,0,a.ud,a.vd)}else{f=a.la;g=f+a.K;k=e=h=0;b=a.F;m=0;c=a.O;r=d=0;n=a.na;u=(1<<n)-1;a.yd&&(n=-n,r=16+n);for(;f<g;){y=vc(a.J,f);if(a.X&&y===a.C[h])e+=a.fb;else{a.C[h]=y;(z=r)&&(y=y>>8|(y&255)<<8);e<b&&(b=e);for(t=a.fb;t--;)ea=y>>z&u,Wf(a,a.cb,e++,k,ea),z+=n;e>m&&(m=e);k<c&&(c=k);k>=d&&(d=k+1)}f+=2;h++;if(e>=a.F&&(e=0,k++,k>a.O))break}a.X=!0;b<a.F&&(f=m-b,d-=c,a.i&&(g=
b,h=f,b=c,f=d,c=a.F-(g+h),d=h),a.ta.putImageData(a.cb,0,0,b,c,f,d),a.u.drawImage(a.G,0,0,a.G.width,a.G.height,0,0,a.N,a.I))}}var Of=0,Pf=1,Mf=2,If=0,Nf=1,Qf=2,Hf={SI1978:Nf,VT100:Qf},Rf=96,Tf=64,Uf=32,Vf=0,Xf=127,Zf=15,$f=16,Yf=96,ag=8192,bg=16384;
nb(function(){for(var a=Ib(document,"pcx80","video"),b=0;b<a.length;b++){var c=a[b],d=Jb(c),e=Ib(c,"pcjs-canvas");if(!e||!e.length||!e[0].getContext){c.innerHTML="<br/>Missing &lt;canvas&gt; support. Please try a newer web browser.";break}e=e[0];e.style.backgroundColor=d.screenColor;0<=Xa().indexOf("MSIE")&&(c.onresize=function(h,k,m,n){return function(){k.style.height=(h.clientWidth*n/m|0)+"px"}}(c,e,d.screenWidth,d.screenHeight),c.onresize());var f=+(d.aspect||ib("aspect"));f&&.3<=f&&3.33>=f&&(mb("onresize",
function(h,k,m){return function(){k.style.height=(h.clientWidth/m|0)+"px"}}(c,e,f)),window.onresize());f=document.createElement("textarea");bb("iOS")&&(f.setAttribute("autocapitalize","off"),f.setAttribute("autocorrect","off"),f.style.fontSize="16px");c.appendChild(f);var g=e.getContext("2d");d=new Gf(d,e,g,f,c);Hb(d,c)}});
function cg(a){x.call(this,"SerialPort",a,4096);this.U=+a.adapter;switch(this.U){case 0:this.V=0;this.Y=2;break;default:w("Unrecognized serial adapter #"+this.U);return}this.i=this.u=null;this.W=a.tabSize;this.T=a.charBOL;this.A=0;this.O=!1;this.G=!0;a=a.binding;if("console"==a)this.u="";else if(a){var b=Mb("Panel",this.id);b&&(b=b.R[a])&&this.ea("",a,b)}this.C="";this.g=this.Qa=this.I=null;this.exports={connect:this.Gc,receiveData:this.Mb,receiveStatus:this.le}}ra(cg,x);l=cg.prototype;
l.ea=function(a,b,c,d){var e=this;return a&&"textarea"!=a?d?(this.R[b]=c,c.onclick=function(){e.Mb(d);return!0},!0):!1:(this.R[b]=this.i=c,c.onkeydown=function(f){f=f||window.event;var g=f.keyCode;if(8===g||f.ctrlKey&&65<=g&&90>=g)f.preventDefault&&f.preventDefault(),64<g&&(g-=64),dg(e,g);return!0},c.onkeypress=function(f){f=f||window.event;dg(e,f.which||f.keyCode);f.preventDefault&&f.preventDefault();return!0},c.removeAttribute("readonly"),!0)};
l.Fa=function(a,b,c,d){this.S=a;this.J=b;this.B=c;this.L=d;var e=this;this.Z=Cd(this.B,this.id+".receive",function(){e.Mb()});this.aa=Cd(this.B,this.id+".transmit",function(){pf(e)});this.X=kc(a,"ChipSet");Hc(b,this,eg,this.V);Kc(b,this,fg,this.V);Wb(this)};
l.Gc=function(a){if(!this.g){var b=fd(this.S,"connection");if(b){var c=b.split("->");if(2==c.length){var d=Na(c[0]);if(d!=this.Fb)return;c=Na(c[1]);if(this.g=Lb(c)){var e=this.g.exports;if(e){var f=e.connect;f&&f.call(this.g,this.G);if(this.Qa=e.receiveData){this.G=a;this.I=e.receiveStatus;this.status("Connected %s.%s to %s",this.Ra,d,c);return}}}}this.status("Unable to establish connection: %s",b)}}};
l.va=function(a,b){if(!b)if(this.Gc(this.G),!a||!this.restore)this.reset();else if(!this.restore(a))return!1;return!0};l.ua=function(a){return a?this.save():!0};l.reset=function(){gg(this)};l.save=function(){var a=new Pd(this),b=0,c=[];c[b++]=this.H;c[b++]=this.N;c[b++]=this.P;c[b++]=this.ia;c[b++]=this.D;c[b++]=this.F;c[b]=this.K;a.set(0,c);return a.data()};l.restore=function(a){return gg(this,a[0])};
function gg(a,b){var c=0;void 0===b&&(b=hg);a.H=b[c++];a.N=b[c++];a.P=b[c++];a.ia=b[c++];a.D=b[c++];a.F=b[c++];a.K=b[c];return!0}function ig(a,b){var c=a.K&b;b&15||(c>>=4);b=jg[c];c=((a.D&kg)>>2)+6;a.D&lg&&c++;c+=((a.D&mg)>>6)+1>>1;return 1E3/(b/c)|0}function dg(a,b){ec(a,"receiveByte("+za(b)+"), status="+za(a.ia));return a.O||a.ia&ng?!1:(a.N=b,a.ia|=ng,me(a.B,a.Y),!0)}
l.Mb=function(a){null!=a&&(this.C="number"!=typeof a?a:this.C+String.fromCharCode(a));this.C&&(dg(this,this.C.charCodeAt(0))&&(this.C=this.C.substr(1)),this.C&&this.B&&Dd(this.B,this.Z,ig(this,og)));return!0};l.le=function(a){this.ia&=~pg;a&64&&(this.ia|=pg)};function pf(a,b){a.ia=a.ia|Ue|qg;b&&a.Qa&&a.Qa.call(a.g,b)}l.Fd=function(a,b){var c=this.N;A(this,a,void 0,b,"DATA",c);this.ia&=~ng;return c};l.Ed=function(a,b){var c=this.ia;A(this,a,void 0,b,"STATUS",c);return c};
l.Td=function(a,b,c){A(this,a,b,c,"DATA");this.P=b;this.ia&=~(Ue|qg);ec(this,"transmitByte("+za(b)+")");if(19==b)this.O=!0;else if(17==b)this.O=!1;else if(this.Qa&&this.Qa.call(this.g,b),this.i)if(8==b)this.i.value=this.i.value.slice(0,-1),0<this.A&&this.A--;else{var d;13!=b&&10!=b&&(d=Qa[b]);a=d=d?"<"+d+">":String.fromCharCode(b);c=a.length;9==b?(b=this.W||8,c=b-this.A%b,this.W&&(a=Ga("",c))):13==b&&(this.A=c=0,a="\n");this.T&&!this.A&&c&&(a=String.fromCharCode(this.T)+a);this.i.value+=a;this.i.scrollTop=
this.i.scrollHeight;this.A+=c}else if(null!=this.u){if(10==b||1024<=this.u.length)this.j(this.u),this.u="";10!=b&&(this.u+=String.fromCharCode(b))}this.B&&Dd(this.B,this.aa,ig(this,rg))};l.Sd=function(a,b,c){A(this,a,b,c,"CONTROL");this.H?(this.I&&(b^this.F)&(sg|tg)&&(a=0,this.G?(a|=b&sg?32:0,a|=b&tg?320:0):(a|=b&sg?16:0,a|=b&tg?1048576:0),this.I.call(this.g,a)),this.F=b,this.F&ug&&(this.H=!1)):(this.D=b,this.H=!0)};l.Rd=function(a,b,c){A(this,a,b,c,"BAUDRATES");this.K=b};
var kg=12,lg=16,mg=192,tg=2,sg=32,ug=64,Ue=1,ng=2,qg=4,pg=128,og=15,rg=240,jg=[50,75,110,134.5,150,200,300,600,1200,1800,2E3,2400,3600,4800,9600,19200],hg=[!1,0,0,133,142,39,238],eg={0:cg.prototype.Fd,1:cg.prototype.Ed},fg={0:cg.prototype.Td,1:cg.prototype.Sd,2:cg.prototype.Rd};nb(function(){for(var a=Ib(document,"pcx80","serial"),b=0;b<a.length;b++){var c=a[b],d=Jb(c);d=new cg(d);Hb(d,c)}});
function vg(a,b,c){x.call(this,a,b,c);this.A=+b.base||16;this.X=["{","}"];this.fa=["[","]"];this.U=this.ca=this.H=0;this.P=!1;this.g=-1;this.i=[];this.C={}}ra(vg,x);vg.prototype.Ib=function(){return-1};vg.prototype.Jb=function(){};
vg.prototype.yb=function(a,b,c){if(b)if(a){0>this.g&&this.i.length&&(this.g=0);if(0>this.g||a!=this.i[this.g])this.i.splice(0,0,a),this.g=0;this.g--}else this.P?a="end":a=this.i[this.g+1];b=[];if(a){a=a.replace(/""/g,"'");var d=0,e=null;c=c||";";for(var f=0;f<=a.length;f++){var g=a.charAt(f);if('"'==g||"'"==g)e?g==e&&(e=null):e=g;else if(g==c&&!e||!g)b.push(Na(a.substring(d,f))),d=f+1}}return b};
function wg(a,b,c){var d=a;b=b||32;if(c)if(32==b)d=a>>>0;else if(32>b)d=a&(1<<b)-1;else{if(b=Math.pow(2,b),0>a||a>=b)d=a%b,0>d&&(d+=b)}else 32>=b?d=a<<32-b>>32-b:(b=Math.pow(2,b-1),a>=b?(d=a%b,(a/b|0)&1&&(d-=b)):a<-b&&(d=a%b,((-a-1)/b|0)&1?d&&(d+=b):d||(d-=b)));a!=d&&(a=d);return a}
function xg(a,b,c){for(c=void 0===c?-1:c;c--&&b.length;){var d=b.pop();if(2>a.length)return!1;var e=a.pop();var f=a.pop();switch(d){case "*":f*=e;break;case "/":if(!e)return!1;f=Math.trunc(f/e);break;case "^/":if(!e)return!1;f%=e;break;case "+":f+=e;break;case "-":f-=e;break;case "<<":f<<=e;break;case ">>":f>>=e;break;case ">>>":f>>>=e;break;case "<":f=f<e?1:0;break;case "<=":f=f<=e?1:0;break;case ">":f=f>e?1:0;break;case ">=":f=f>=e?1:0;break;case "==":f=f==e?1:0;break;case "!=":f=f!=e?1:0;break;
case "&":f&=e;break;case "!":case "|":f|=e;break;case "^!":f^=e;break;case "&&":f=f&&e?1:0;break;case "||":f=f||e?1:0;break;case ",,":f=wg(f,18,!0)*Math.pow(2,18)+wg(e,18,!0);break;case "_":case "^_":"^_"==d&&(e=35-(e&255));e&&(f=wg(f,0,!0),f=0<e?f*Math.pow(2,e):Math.trunc(f/Math.pow(2,-e)));break;default:return!1}a.push(wg(f))}return!0}
function yg(a,b,c,d,e,f){var g,h=!1,k=0,m=[],n=[],r=a.A;for(a.A=e;c<d;){var u=b[c++].trim();var t=c<d?b[c++]:"";if(u)var y=zg(a,u,void 0,f,k);else if("{"==t){u=1;for(y=c;c<d;)if(c++,t=c<b.length?b[c++]:"","{"==t)u++;else if("}"==t&&!--u)break;y=yg(a,b,y,c-1,a.A,f);null!=y&&k&&(y=Ag(y,k));u=c<d?b[c++].trim():"";t=c<d?b[c++]:""}else{if(" "==t)continue;if("^B"==t){a.A=2;continue}if("^O"==t){a.A=8;continue}if("^D"==t){a.A=10;continue}if(!(k&-1073741824)){if("+"==t)continue;if("-"==t){k=k<<2|1;continue}if("~"==
t||"^-"==t){k=k<<2|2;continue}if("^L"==t){k=k<<2|3;continue}}h=!0;break}if(void 0===y)if(f)f.push(u),y=0;else{h=!0;f=[];break}m.push(wg(y));if(" "==t)if(c<b.length-1&&!b[c])c++,t=b[c++];else{h=!0;break}if(!t)break;k="<"==a.X[0]?Bg:Cg;if(!k[t]){h=!0;break}n.length&&k[t]<=k[n[n.length-1]]&&xg(m,n,1);n.push(t);a.A="^_"==t?10:e;k=0}if(h||!xg(m,n)||1!=m.length)h=!0;h?f||a.j("parse error ("+(u||t)+")"):g=m.pop();a.A=r;return g}
function Dg(a,b,c,d,e){for(var f;0<=(f=b.indexOf(c));){for(var g=0,h=f+1,k=e;h<b.length;){var m=b[h++];if(m==c){k=-1;break}if(!k)break;k--;m=m.charCodeAt(0);7==d?m&=127:m=m-32&63;g=wg(g*Math.pow(2,d)+m,d*e,!0)}if(0<=k){a.j("parse error ("+c+b+c+")");return}b=b.substr(0,f)+Eg(a,g,-1)+b.substr(h)}return b}
function Fg(a,b,c){var d=void 0,e=!1===c;c=Array.isArray(c)?c:void 0;if(b){"{"!=a.X[0]&&(b=b.split(a.X[0]).join("{").split(a.X[1]).join("}"));b=Dg(a,b,'"',7,5);if(!b)return d;b=Dg(a,b,"'",6,6);if(!b)return d;16!=a.A&&(b=b.replace(/(^|[^A-Z0-9$%.])([0-9]+)B/,"$1$2^_").replace(/\s+/g," "));b=b.split(/({|}|\|\||&&|\||\^!|\^B|\^O|\^D|\^L|\^-|~|\^_|_|&|!=|!|==|>=|>>>|>>|>|<=|<<|<|-|\+|\^\/|\/|\*|,,| )/);d=yg(a,b,0,b.length,a.A,c);void 0!==d&&e&&Gg(a,null,d)}return d}
function Hg(a,b){var c=a.X[0],d=a.X[1];var e="("==c||"{"==c||"["==c?"\\":"";var f="["==c?"\\":"";for(f=new RegExp(e+c+"([^"+f+c+f+d+"]+)"+e+d);e=b.match(f);){var g=Fg(a,e[1]);if(void 0===g)return;b=b.replace(c+e[1]+d,null!=g?Eg(a,g):"undefined")}if(a.fa.length)for(c=a.fa[0],d=a.fa[1],e="("==c||"{"==c||"["==c?"\\":"",f="["==c?"\\":"",f=new RegExp(e+c+"([^"+f+c+f+d+"]+)"+e+d);e=b.match(f);)b=b.replace("["+e[1]+"]","unimplemented");for(;c=b.match(/\$([a-z]+)/i);){d=null;switch(c[1].toLowerCase()){case "ops":d=
a.U-a.ca}if(null==d)break;b=b.replace(c[0],d.toString())}return b}function Ag(a,b){for(;b;){var c;switch(b&3){case 1:a=-wg(a);break;case 2:a^=-1;break;case 3:for(c=35;0<=c&&!(a&Math.pow(2,c));)c--;a=35-c}b>>>=2}return a}
function zg(a,b,c,d,e){e=void 0===e?0:e;var f=Array.isArray(d)?d:void 0;if(void 0!=b){var g=a.Ib(b);if(0<=g)g=a.Jb(g);else if(g=b,a.C[g]?g=a.C[g].value:(g=g.substr(0,6),g=a.C[g]&&a.C[g].value),void 0!=g){var h=a.C[b]&&a.C[b].ne;h&&(f?f.push(h):(f=Fg(a,h,d),void 0!==f?g+=f:(d||a.j("undefined "+(c||"value")+": "+b+" ("+h+")"),g=void 0)))}else g=xa(b,1<b.length||10<a.A?a.A:10);void 0!=g?g=wg(Ag(g,e)):d||a.j("invalid "+(c||"value")+": "+b)}else d||a.j("missing "+(c||"value"));return g}
function Gg(a,b,c){var d=!1;if(void 0!==c){d=!0;var e=8==a.A?Eg(a,c,32,8,1)+"  "+c+".":Eg(a,c,32,16,1)+"  "+Eg(a,c,32,8,1)+"  "+Eg(a,c,32,2,8)+"  "+c+".";32<=c&&127>c&&(e+=" '"+String.fromCharCode(c)+"'")}a.j((null!=b?b+": ":"")+e);return d}function jh(a,b){var c=0;if(a.C){if(b)return Gg(a,b,a.C[b]&&a.C[b].value);b=Object.keys(a.C);b.sort();for(var d=0;d<b.length;d++)Gg(a,b[d],a.C[b[d]].value),c++}return 0<c}
function Eg(a,b,c,d,e){c=void 0===c?0:c;e=void 0===e?0:e;switch((void 0===d?0:d)||a.A){case 2:(a=0<c?c:0)?36<a&&(a=36):(a=Math.abs(b),a=255>=a?8:262143>=a?18:36);b=ya(b,2,a,"",e);break;case 8:(a=0<c?(c+2)/3|0:0)?12<a&&(a=12):(a=Math.abs(b),a=262143>=a?6:16777215>=a?8:12);b=ya(b,8,a,e?"0o":"");break;case 10:(e=0<c?Math.ceil(.3*c):0)?11<e&&(e=11):e=99999>=Math.abs(b)?5:11;b=ya(b,10,e);break;default:b=q(b,0<c?c+3>>2:0,!!e)}return c=0>c?b.replace(/^0+([0-9A-F]+)$/i,"$1"):b}
var Cg={"||":5,"&&":6,"!":7,"|":7,"^!":8,"&":9,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,_:19,"^_":19,"{":20,"}":20},Bg={",,":1,"||":5,"&&":6,"!=":10,"==":10,">=":11,">":11,"<=":11,"<":11,">>>":12,">>":12,"<<":12,"-":13,"+":13,"^/":14,"/":14,"*":14,"!":15,"|":15,"^!":15,"&":15,_:19,"^_":19,"{":20,"}":20};
function lh(a){vg.call(this,"Debugger",a,-1);this.style=mh;this.N=nh();this.sa=nh();this.V=nh();this.F=[];this.u=this.O=this.D=[];oh(this);this.Y=0;ph(this);this.la={};qh(this,a.messages);this.na=a.commands;var b=this;window?void 0===window.pcx80&&(window.pcx80=function(c){return jd(b,c)}):void 0===global.pcx80&&(global.pcx80=function(c){return jd(b,c)})}ra(lh,vg);l=lh.prototype;
l.Fa=function(a,b,c,d){this.J=b;this.B=c;this.S=a;(a=fd(a,"messages"))&&qh(this,a);this.oa=rh;Re(this,4,function(e){a:{var f=d.J.g,g=e[0],h=e=0,k=f.length;if(g){e=sh(th(d,g));if(-1===e){d.j("invalid address: "+g);break a}h=e>>>d.J.i;k=1}d.j("blockid   physical   blockaddr   used    size    type");d.j("--------  ---------  ----------  ------  ------  ----");g=-1;for(var m=0;k--;){var n=f[h];n.type==g?m++||d.j("..."):(g=n.type,m=rc[g],n&&d.j(q(n.id)+"  %"+q(h<<d.J.i)+"  %%"+q(n.M)+"  "+v(n.nb)+"  "+
v(n.size)+"  "+m),g!=Rc&&(g=-1),m=0);e+=d.J.A;h++}}});Wb(this)};
l.ea=function(a,b,c){var d=this;switch(b){case "debugInput":return this.K=this.R[b]=c,c.onkeydown=function(e){if(13==e.keyCode){var f=d.K.value;d.K.value="";jd(d,f,!0)}else if(27==e.keyCode)d.K.value=f="";else if(38==e.keyCode?(f=null,d.g<d.i.length-1&&(f=d.i[++d.g])):40==e.keyCode&&(0<d.g?f=d.i[--d.g]:(f="",d.g=-1)),null!=f){var g=f.length;d.K.value=f;d.K.setSelectionRange(g,g)}null!=f&&e.preventDefault&&e.preventDefault()},!0;case "debugEnter":return this.R[b]=c,lb(c,function(){if(d.K){var e=d.K.value;
d.K.value="";jd(d,e,!0);return!0}return!1}),!0;case "step":return this.R[b]=c,lb(c,function(e){var f=!1;Xb(d,!0)||(Yb(d,!0),f=uh(d,e?1:0),Yb(d,!1));return f}),!0}return!1};l.Ya=function(){this.K&&this.K.focus()};function sh(a){a=a&&a.M;null==a&&(a=-1);return a}l.Ga=function(a,b){var c=255,d=sh(a);-1!==d&&(c=tc(this.J,d),b&&vh(a,b));return c};l.Db=function(a,b){var c=65535,d=sh(a);-1!==d&&(c=vc(this.J,d),b&&vh(a,b));return c};
l.bc=function(a,b,c){var d=sh(a);-1!==d&&(Fc(this.J,d,b),c&&vh(a,c),ud(this.B,!0))};l.Yc=function(a,b,c){var d=sh(a);if(-1!==d){var e=this.J,f=d&e.u,g=(d&e.F)>>>e.i;f!=e.u?e.g[g].Rb(f,b&65535,d):(e.g[g++].ob(f,b&255,d),e.g[g&e.I].ob(0,b>>8&255,d+1));c&&vh(a,c);ud(this.B,!0)}};function nh(a){return{M:a,Ca:!1}}function wh(a){return{M:a[0],Ca:a[1]}}
function th(a,b,c){c=(c?a.N:a.sa).M;if(void 0!==b){b=Hg(a,b)||b;var d;if(b.match(/^[a-z_][a-z0-9_]*$/i)){var e=b.toUpperCase();for(c=0;c<a.F.length;c++){var f=a.F[c].ra[e];if(void 0!==f){e=f.o;void 0!==e&&(d=nh(e));break}}}if(e=d)return e;c=Fg(a,b)}null!=c&&(e=nh(c));return e}function xh(a,b,c){c&&(c=c.match(/(['"])(.*?)\1/))&&(b.td=a.yb(b.Kc=c[2]))}function vh(a,b){null!=a.M&&(a.M+=b||1)}function yh(a){return q(a.M,4)}
function zh(a,b,c){var d="";for(c=c||256;d.length<c;){var e=a.Ga(b,1);if(!e||36==e||127<=e)break;d+=32<=e?String.fromCharCode(e):"."}return d}function qh(a,b){a.L=a;a.ha=268435456;a.Z=null;a.aa=[];b=a.yb(b.replace("keys","key").replace("kbd","keyboard"),!1,"|");if(b.length)for(var c in ic)0<=Sa(b,c)&&(a.ha|=ic[c],a.j(c+" messages enabled"))}function Re(a,b,c){for(var d in ic)if(b==ic[d]){a.la[d]=c;break}}
l.Ib=function(a,b){a=a.toUpperCase();if(null==b)var c=Sa(Ah,a);else c=Sa(Ah,a.substr(b,2)),0>c&&(c=Sa(Ah,a.substr(b,1)));return c};function Bh(a,b){var c=0;a=a.Jb(b);if(void 0!==a)switch(b){case Ch:case Dh:case Eh:case Fh:case Gh:case Hh:case Ih:case Jh:c=2;break;case Kh:case Lh:case Mh:case Nh:case Oh:case Ph:case Qh:c=4}return c?q(a,c):"??"}
l.Jb=function(a){if(0<=a){var b=this.B;switch(a){case Ch:var c=b.i;break;case Dh:c=b.A;break;case Eh:c=b.C;break;case Kh:c=Qd(b);break;case Fh:c=b.D;break;case Gh:c=b.F;break;case Lh:c=Sd(b);break;case Hh:c=b.G;break;case Ih:c=b.H;break;case Mh:c=E(b);break;case Jh:c=G(b,E(b));break;case Nh:c=b.N;break;case Oh:c=b.u;break;case Ph:c=Od(b);break;case Qh:c=Od(b)&255|b.i<<8}}return c};
l.message=function(a,b){b&&(a+=" at "+yh(nh(this.B.u)));this.ha&1073741824?this.aa.push(a):this.Z&&a==this.Z||(this.Z=a,this.ha&536870912&&(cd(this),a+=" (cpu halted)"),this.j(a),this.B&&(a=this.B,Ed(a),a.ta=0,ud(a)))};function fc(a,b,c,d,e,f,g,h){h|=16;null!=f&&(a.ha&h)!=h||a.message(b.Fb+"."+(null!=d?"outPort":"inPort")+"("+v(c)+","+(f?f:"unknown")+(null!=d?","+za(d):"")+")"+(null!=g?": "+za(g):"")+(null!=e?" at "+q(e,4):""))}
function ph(a){var b;if(ne(a)){if(!a.I||!a.I.length){a.I=Array(Rh);for(b=0;b<a.I.length;b++)a.I[b]=nh();a.W=0;a.j("instruction history buffer allocated")}if(!a.G||!a.G.length)for(a.G=Array(256),b=0;b<a.G.length;b++)a.G[b]=[b,0]}else a.I&&a.I.length&&a.j("instruction history buffer freed"),a.W=0,a.I=[],a.G=[]}function Sh(a,b){if(!Th(a))return!1;a.B.sb(b);return!0}
function uh(a,b,c,d){if(!Th(a))return!1;a.H=0;b||ne(a)&&oe(a,a.B.u,0);try{var e=a.B.Cb(b);0<e&&(a.H+=e,zd(a.B,e,!0),vd(a.B,e),a.U++)}catch(f){"number"!=typeof f&&(b=f,a.H=0,Ub(a.B,b.stack||b.message))}!1!==d&&ud(a.B);id(a,c||!1);return 0<a.H}function cd(a,b){a.B&&xd(a.B,b)}function id(a,b){void 0===b&&(b=!0);a.N=nh(a.B.u);b&&1!=a.T?Uh(a):Vh(a)}
function Th(a){var b;if(b=a.B&&Vb(a.B))b=a.B,b.flags.ja?b=!0:(b.j(b.toString()+" not powered"),b=!1);b&&!Xb(a.B)?(a=a.B,a.flags.error?(a.j(a.toString()+" error"),a=!0):a=!1,a=!a):a=!1;return a}l.va=function(a,b){return!b&&(this.reset(!0),a&&this.restore&&!this.restore(a))?!1:!0};l.ua=function(a,b){b&&this.j(a?"suspending":"shutting down");return a?this.save():!0};l.reset=function(a){ph(this);this.U=this.ca=0;this.Z=null;this.H=0;this.N=nh(this.B.u);this.flags.ka=!1;Wh(this);a||id(this)};
l.save=function(){var a=new Pd(this),b=this.N;a.set(0,[b.M,b.Ca]);b=this.V;a.set(1,[b.M,b.Ca]);a.set(2,[this.i,this.P,this.ha]);a.set(3,this.F);return a.data()};l.restore=function(a){var b=0;void 0!==a[2]&&(this.N=wh(a[b++]),this.V=wh(a[b++]),this.i=a[b][0],"string"==typeof this.i&&(this.i=[this.i]),this.P=a[b][1],this.ha|=a[b][2]);a[3]&&(this.F=a[3]);return!0};l.start=function(a,b){this.T||this.j("running");this.flags.ka=!0;this.ya=a;this.za=b};
l.stop=function(a,b){if(this.flags.ka){this.flags.ka=!1;this.H=b-this.za;if(!this.T){b="stopped";if(this.H){a-=this.ya;var c=0<a?Math.round(1E3*this.H/a):0;b+=" (";ne(this)&&(b+=this.U+" opcodes, ",this.ca-=this.U,this.U=0);b+=this.H+" cycles, "+a+" ms, "+c+" hz)"}else dc(this,536870912)&&(b+=" (use the 't' command to execute blocked faults)");this.j(b)}id(this,!0);this.Ya();Wh(this,this.B.u)}};function ne(a){return 1<a.u.length||!!a.Y}
function oe(a,b,c){var d=a.B;if(0<c&&(a.Y&&!--a.Y||bd(a,b,1,a.u)))return!0;0<=c&&a.G.length&&(a.U++,b=tc(a.J,b),null!=b&&(a.G[b][1]++,b=a.I[a.W],b.M=d.u,b.Ca=!1,++a.W==a.I.length&&(a.W=0)));return!1}function Jc(a,b,c){a.j("break on input from port "+v(b)+": "+q(c));cd(a,!0)}function Mc(a,b,c){a.j("break on output to port "+v(b)+": "+q(c));cd(a,!0)}
function oh(a){var b;a.u=["bp"];if(void 0!==a.O)for(b=1;b<a.O.length;b++){var c=a.O[b];var d=a.J;ad(d.g[sh(c)>>>d.i],!1)}a.O=["br"];if(void 0!==a.D)for(b=1;b<a.D.length;b++)c=a.D[b],d=a.J,ad(d.g[sh(c)>>>d.i],!0);a.D=["bw"];a.ta=0}l.Oa=function(a,b,c){var d=!0;c||Xh(this,a,b,!1,!0);if(a!=this.u){var e=sh(b);if(-1===e)this.j("invalid address: "+yh(b)),d=!1;else{var f=this.J;f.g[e>>>f.i].Oa(e&f.u,a==this.D)}}d&&(a.push(b),c?b.Ca=!0:(Yh(this,a,a.length-1,"set"),ph(this)))};
function Xh(a,b,c,d,e){var f=!1;c=sh(c);for(var g=1;g<b.length;g++){var h=b[g];if(c==sh(h)&&(!d||h.Ca)){f=!0;h.Ca||e||Yh(a,b,g,"cleared");b.splice(g,1);b!=a.u&&(d=a.J,ad(d.g[c>>>d.i],b==a.D));h.Ca||ph(a);break}}return f}function Zh(a,b){for(var c=1;c<b.length;c++)Yh(a,b,c);return b.length-1}function Yh(a,b,c,d){c=b[c];a.j(b[0]+" "+yh(c)+(d?" "+d:c.Kc?' "'+c.Kc+'"':""))}
function Wh(a,b){if(void 0!==b)bd(a,b,1,a.u,!0),a.T=0;else for(b=1;b<a.u.length;b++){var c=a.u[b];if(c.Ca){if(!Xh(a,a.u,c,!0))break;b=0}}}
function bd(a,b,c,d,e){var f=!1;if(!a.ta++)for(var g=1;!f&&g<d.length;g++){var h=d[g];if(!e||h.Ca)for(var k=sh(h),m=0;m<c;m++)if(b+m==k){var n;f=!0;h.Ca&&(Xh(a,d,h,!0),e=!0);if(n=h.td){f=!1;for(var r=0;r<n.length;r++)if(!$h(a,n[r],!0)){if(n[r].indexOf("if")){f=!0;break}for(var u=r+1;u<n.length&&n[u].indexOf("else");u++)r++;if(u==n.length){f=!0;break}}a.B.flags.ka||(f=!0)}if(f){e||Yh(a,d,g,"hit");break}}}a.ta--;return f}
function ai(a,b,c,d){for(var e=nh(b.M),f=a.Ga(b,1),g=a.oa[f],h="",k=(a.style!=bi?ci:di)[g[0]],m=g.length-1,n=ei,r,u=1;u<=m;u++){var t="";r=g[u];if(void 0!==r&&!(r&P&&a.style==mh)){var y=r&fi;if(y){var z=r&gi;z?n=z:r|=n;r&hi||(r|=1==u?ii:ji);if(y&Q)a:{t=a;y=r;z=b;switch(y&gi){case ki:z=q(t.Ga(z,1),2);break;case li:z=q(t.Ga(z,1)<<24>>24,4);break;case mi:z=q(t.Db(z,2),4);break;default:t="imm("+v(y)+")";break a}t.style==bi&&y&ni?z="["+z+"]":y&oi||(z=(t.style==mh?"$":"0x")+z);t=z}else y&oi?(t=(r&pi)>>
8,y=Ah[t],a.style==bi&&r&ni&&(t==Jh&&(y="HL"),y="["+y+"]"),t=y):y&qi&&(t=(f>>3&7).toString());if(!t||!t.length){h="INVALID";break}0<h.length&&(h+=",");h+=t||"???"}}}f="";g=yh(e)+" ";if(-1!==e.M&&-1!==b.M){do if(f+=q(a.Ga(e,1),2),null==e.M)break;while(e.M!=b.M)}g+=Ga(f,10);g+=r&ri?"*":" ";g+=Ga(k,7);h&&(g+=" "+h);c&&(g=Ga(g,40)+";"+c,g=a.B.flags.Wa?g+("cycles="+wd(a.B).toString()+" cs="+q(a.B.wa)):g+(null!=d?"="+d.toString():""));return g}
function si(a,b){switch(b){case "IF":a=a.B.O&512;break;case "SF":a=$d(a.B);break;case "ZF":a=Zd(a.B);break;case "AF":a=Yd(a.B);break;case "PF":a=Xd(a.B);break;case "CF":a=Vd(a.B);break;default:a=0}return b.charAt(0)+(a?"1":"0")+" "}function ti(a,b){return Ah[b]+"="+Bh(a,b)+" "}l.Bc=function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0};
function ui(a,b,c){var d=[],e=sh(b)>>>0;for(b=0;b<a.F.length;b++){var f=a.F[b],g=f.M>>>0,h=f.Od;if(e>=g&&e<g+h){e=Ra(f.zc,[e-g],a.Bc);0<=e?vi(a,b,e,d):c&&(e=~e,vi(a,b,e-1,d),vi(a,b,e,d));break}}return d}function vi(a,b,c,d){var e={},f=a.F[b].zc,g=0,h=null;0<=c&&c<f.length&&(g=f[c][0],h=f[c][1]);h&&(e=a.F[b].ra[h],h="."==h.charAt(0)?null:e.l||h);d.push(h);d.push(g);d.push(e.a);d.push(e.c)}
function wi(a,b){if("?"==b)a.j("frequency commands:"),a.j("\tclear\tclear all frequency counts");else{var c=0;if(a.G)if("clear"==b){for(b=0;b<a.G.length;b++)a.G[b]=[b,0];a.j("frequency data cleared");c++}else if(void 0!==b)a.j("unknown frequency command: "+b),c++;else{var d=a.G.slice();d.sort(function(h,k){return k[1]-h[1]});var e=a.style!=bi?ci:di;for(b=0;b<d.length;b++){var f=d[b][0],g=d[b][1];g&&(a.j((e[a.oa[f][0]]+"  ").substr(0,5)+" ("+za(f)+"): "+g+" times"),c++)}}c||a.j("no frequency data available")}}
function xi(a,b){var c=b.match(/^\s*([A-Z_]?[A-Z0-9_]*)\s*(=?)\s*(.*)$/i);if(c){if(!c[1])return jh(a)||a.j("no variables"),!0;if(!c[2])return jh(a,c[1]);if(!c[3])return delete a.C[c[1]],!0;b=Fg(a,c[3]);return void 0!==b?(a.C[c[1]]={value:b,ne:void 0},!0):!1}a.j("invalid assignment:"+b);return!1}
function yi(a,b,c){var d=null;if(b=th(a,b,!0)){var e=ui(a,b,!0);if(e.length){var f;if(e[0]){var g="";(f=b.M-e[1])&&(g=" + "+v(f));f=e[0]+" ("+q(e[1],4)+")"+g;c&&a.j(f);d=f}4<e.length&&e[4]&&(g="",(f=e[5]-b.M)&&(g=" - "+v(f)),f=e[4]+" ("+q(e[5],4)+")"+g,c&&a.j(f),d||(d=f))}else c&&a.j("no symbols")}return d}
function zi(a,b){switch(b[1]){case "8080":a.style=mh;break;case "8086":a.style=bi;break;case "cs":var c;void 0!==b[3]&&(c=+b[3]);switch(b[2]){case "int":a.B.na=c;break;case "start":a.B.ya=c;break;case "stop":a.B.sa=c;break;default:a.j("unknown cs option");return}void 0!==c&&hd(a.B);a.j("checksums "+(a.B.flags.Wa?"enabled":"disabled"));return;case "sp":void 0!==b[2]&&(yd(a.B,+b[2])||a.j("warning: using 1x multiplier, previous target not reached"));a.j("target speed: "+(a.B.aa.toFixed(2)+"Mhz (")+a.B.U+
"x)");return;case "?":a.j("debugger options:");a.j("\tX80\t\tselect 8080-style mnemonics");a.j("\t8086\t\tselect 8086-style mnemonics");a.j("\tcs int #\tset checksum cycle interval to #");a.j("\tcs start #\tset checksum cycle start count to #");a.j("\tcs stop #\tset checksum cycle stop count to #");a.j("\tsp #\t\tset speed multiplier to #");break;default:if(b[1]){a.j("unknown option: "+b[1]);return}}a.j(a.style+"-style mnemonics enabled")}
function Uh(a,b){var c;if(b&&"?"==b[1])a.j("register commands:"),a.j("\tr\tdump registers"),a.j("\trx [#]\tset flag or register x to [#]");else{var d=a.B;null==c&&(c=!0);if(null!=b&&1<b.length){var e=b[1],f=e.indexOf("=");if(0<f)b=e.substr(f+1),e=e.substr(0,f);else if(2<b.length)b=b[2];else{a.j("missing value for "+b[1]);return}f=Fg(a,b);if(void 0===f)return;switch(e.toUpperCase()){case "A":d.i=f&255;break;case "B":d.A=f&255;break;case "BC":d.A=f>>8&255;case "C":d.C=f&255;break;case "D":d.D=f&255;
break;case "DE":d.D=f>>8&255;case "E":d.F=f&255;break;case "H":d.G=f&255;break;case "HL":d.G=f>>8&255;case "L":d.H=f&255;break;case "SP":d.N=f&65535;break;case "PC":D(d,f);a.N=nh(d.u);break;case "PS":Md(d,f);break;case "PSW":Md(d,f&255|d.O&-256);d.i=f>>8;break;case "CF":d.I=f?d.I|256:d.I&255;break;case "PF":f?Xd(d)||(d.K^=1):Xd(d)&&(d.K^=1);break;case "AF":d.P=f?~d.K&16|d.P&-17:d.K&16|d.P&-17;break;case "ZF":d.I=f?d.I&-256:d.I|255;break;case "SF":f?$d(d)||(d.K^=192):$d(d)&&(d.K^=192);break;case "IF":d.O=
f?d.O|512:d.O&-513;break;default:a.j("unknown register: "+e);return}ud(d);a.j("updated registers:")}e=a.j;f=ti(a,Ch)+ti(a,Kh)+ti(a,Lh)+ti(a,Mh)+ti(a,Nh)+si(a,"IF")+si(a,"SF")+si(a,"ZF")+si(a,"AF")+si(a,"PF")+si(a,"CF");e.call(a,f);c&&(a.N=nh(d.u),Vh(a,yh(a.N)))}}
function Ai(a,b){b=Na(b);var c=b.match(/^(['"])(.*?)\1$/);if(c){b=a.j;c=c[2];c=Hg(a,c)||c;for(var d=0,e,f;0<=(d=c.indexOf("@",d));)f=a.Ib(c,d+1),0<=f&&(c=c.substr(0,d)+Bh(a,f)+c.substr(d+1+Ah[f].length)),d++;for(d=0;0<=(d=c.indexOf("#",d));)f=c.substr(d+1,2),e=xa(f,16),null!=e&&32<=e&&127>e?(e=f+" '"+String.fromCharCode(e)+"'",c=c.replace("#"+f,e),d+=e.length):d++;for(d=0;0<=(d=c.indexOf("$",d));)f=c.substr(d+1,9),(e=th(a,f))?(e=f+' "'+zh(a,e)+'"',c=c.replace("$"+f,e),d+=e.length):d++;for(d=0;0<=
(d=c.indexOf("^",d));)f=c.substr(d+1,9),(e=th(a,f))?(vh(e),e=f+' "'+zh(a,e,11)+'"',c=c.replace("^"+f,e),d+=e.length):d++;b.call(a,c)}else Fg(a,b,!1)}function Bi(a,b,c){var d="t"!=b;c=zg(a,c,void 0,!0)||1;var e=1==c?0:1;"tc"==b&&(e=c,c=1);kb(c,function(){return Yb(a,!0)&&uh(a,e,d,!1)},function(){ud(a.B);Yb(a,!1)})}
function Vh(a,b,c,d){if(b=th(a,b,!0)){void 0===d&&(d=1);var e=256;if(void 0!==c){d=th(a,c,!0);if(!d||d.M<b.M)return;e=d.M-b.M;if(256<e){a.j("range too large");return}d=-1}c=0;for(var f;0<e&&d--;){f=Xb(a,!1)||a.T?a.H:null;var g=null!=f?"cycles":null,h=ui(a,b),k=b.M;if(h[0]&&d&&(!c&&d||0>h[0].indexOf("+"))){var m=h[0]+":";h[2]&&(m+=" "+h[2]);a.j(m)}h[3]&&(g=h[3],f=null);f=ai(a,b,g,f);a.j(f);a.N=b;e-=b.M-k;c++}}}
l.yb=function(a,b,c){if(b)if(a){0>this.g&&this.i.length&&(this.g=0);if(0>this.g||a!=this.i[this.g])this.i.splice(0,0,a),this.g=0;this.g--}else this.P?a="end":a=this.i[this.g+1];b=[];if(a){a=a.toLowerCase().replace(/""/g,"'");var d=0,e=null;c=c||";";for(var f=0;f<=a.length;f++){var g=a.charAt(f);if('"'==g||"'"==g)e?g==e&&(e=null):e=g;else if(g==c&&!e||!g)b.push(Na(a.substring(d,f))),d=f+1}}return b};
function $h(a,b,c){var d=!0;try{b.length&&"end"!=b?c||a.j(">> "+b):(a.P&&(a.j("ended assemble at "+yh(a.V)),a.N=a.V,a.P=!1),b="");var e=b.charAt(0);if('"'==e||"'"==e)return!0;a.Z=null;if(Vb(a)&&0<b.length){a.P&&(b="a "+yh(a.V)+" "+b);var f=b.replace(/ +/g," ").split(" ");if(f&&f.length)for(var g=f[0],h=g.charAt(0),k=1;k<g.length;k++){var m=g.charAt(k);if("?"==h||"r"==h||"a">m||"z"<m){f[0]=g.substr(k);f.unshift(g.substr(0,k));break}}switch(f[0].charAt(0)){case "a":var n=th(a,f[1],!0);if(n)if(a.V=n,
void 0===f[2])a.j("begin assemble at "+yh(n)),a.P=!0,ud(a.B);else{a.j("not supported yet");var r=[];if(r.length){for(var u=0;u<r.length;u++)a.bc(n,r[u],1);a.j(ai(a,a.V))}}break;case "b":a:{var t=f[0],y=f[1],z=b;if("?"==y)a.j("breakpoint commands:"),a.j("\tbi [p]\ttoggle break on input port [p]"),a.j("\tbo [p]\ttoggle break on output port [p]"),a.j("\tbp [a]\tset exec breakpoint at addr [a]"),a.j("\tbr [a]\tset read breakpoint at addr [a]"),a.j("\tbw [a]\tset write breakpoint at addr [a]"),a.j("\tbc [a]\tclear breakpoint at addr [a]"),
a.j("\tbl\tlist all breakpoints"),a.j("\tbn [n]\tbreak after [n] instruction(s)");else{var B=t.charAt(1);if("l"==B){var ea=Zh(a,a.u);ea+=Zh(a,a.O);(ea+=Zh(a,a.D))||a.j("no breakpoints")}else if("n"==B)a.Y=zg(a,y),a.j("break after "+a.Y+" instruction(s)");else if(void 0===y)a.j("missing breakpoint address");else{var F=nh();if("*"!=y&&(F=th(a,y,!0),!F))break a;y=v(F.M);if("c"==B)null==F.M?(oh(a),a.j("all breakpoints cleared")):Xh(a,a.u,F)||Xh(a,a.O,F)||Xh(a,a.D,F)||a.j("breakpoint missing: "+yh(F));
else if("i"==B){var ma=a.j;var T=a.J,ia=F.M;if(void 0===ia){T.G=!T.G;var Oa=T.G}else void 0===T.C[ia]&&(T.C[ia]=[null,!1]),T.C[ia][1]=!T.C[ia][1],Oa=T.C[ia][1];ma.call(a,"breakpoint "+(Oa?"enabled":"cleared")+": port "+y+" (input)")}else if("o"==B){var Rb=a.j;var rb=a.J,Zb=F.M;if(void 0===Zb){rb.H=!rb.H;var Ig=rb.H}else void 0===rb.D[Zb]&&(rb.D[Zb]=[null,!1]),rb.D[Zb][1]=!rb.D[Zb][1],Ig=rb.D[Zb][1];Rb.call(a,"breakpoint "+(Ig?"enabled":"cleared")+": port "+y+" (output)")}else null!=F.M&&(xh(a,F,z),
"p"==B?a.Oa(a.u,F):"r"==B?a.Oa(a.O,F):"w"==B?a.Oa(a.D,F):a.j("unknown breakpoint command: "+B))}}}break;case "c":var Jg=a.S;Jg.D&&(Jg.D.value="");break;case "d":a:{var $b,ac=f[0],cb=f[1],Db=f[2],cj=f[3];if("?"==cb){var bc="";for($b in ic)a.la[$b]&&(bc&&(bc+=","),bc+=$b);bc+=",state,symbols";a.j("dump memory commands:");a.j("\tdb [a] [#]    dump # bytes at address a");a.j("\tdw [a] [#]    dump # words at address a");a.j("\tdd [a] [#]    dump # dwords at address a");a.j("\tdh [#] [#]    dump # instructions from history");
bc.length&&a.j("dump extension commands:\n\t"+bc)}else if("state"==cb){var ve=Ci(a.S,!0);if("console"==Db)console.log(ve);else{var Kg=a.S;Kg.D&&(Kg.D.value="");ve&&a.j(ve)}}else if("symbols"==cb)for(var we=0;we<a.F.length;we++){var xe=a.F[we],cc;for(cc in xe.ra)if("."!=cc.charAt(0)){var Lg=xe.ra[cc].o;if(void 0!==Lg){var Mg=xe.ra[cc].l;Mg&&(cc=Mg);a.j(q(Lg,4)+" "+cc)}}}else{if("d"==ac){for($b in ic)if(f[1]==$b){var Ng=a.la[$b];Ng?(f.shift(),f.shift(),Ng(f)):a.j("no dump registered for "+cb);break a}cb||
(ac=a.Da||"db")}else a.Da=ac;if("dh"==ac){var Og=cb,Pg=Db,Qg="",Rg=0,Pa=a.W,db=a.I;if(db.length){var Ca=+Og||a.wa,wc=+Pg||10;isNaN(Ca)?Ca=wc:Qg="more ";Ca>db.length&&(a.j("note: only "+db.length+" available"),Ca=db.length);Pa-=Ca;0>Pa&&(null==db[db.length-1].M?(Ca=Pa+Ca,Pa=0):Pa+=db.length);var ye=[];"call"==Pg&&(wc=1E5,ye=["CALL"]);void 0!==Og&&a.j(Ca+" instructions earlier:");for(var ze="";0<wc&&Pa!=a.W;){var Sg=db[Pa++];if(null==Sg.M)break;var xc=nh(Sg.M),dj=Ca--,Tg=ai(a,xc,"history",dj);if(!ye.length||
0<=Tg.indexOf(ye[0]))ze+=Tg+"\n";xc.Hb&&(Pa+=xc.Hb,wc-=xc.Hb,Ca-=xc.Hb);Pa>=db.length&&(Pa=0);a.wa=Ca;Rg++;wc--}ze&&a.j(ze)}Rg||(a.j("no "+Qg+"history available"),a.wa=void 0)}else{var kd=th(a,cb);if(kd){var ld=0;Db&&("l"==Db.charAt(0)&&(Db=Db.substr(1)||cj),ld=zg(a,Db)>>>0,65536<ld&&(ld=65536));for(var yc="",md="dd"==ac?4:"dw"==ac?2:1,nd=md*ld||128,ej=nd+15>>4||1;ej--&&0<nd;){var Ae=0,Be=0,zc,Ce="",Ug="";cb=yh(kd);for(zc=16;0<zc&&0<nd;zc--){var od=a.Ga(kd,1);Ae|=od<<(Be++<<3);Be==md&&(Ce+=q(Ae,2*
md),Ce+=1==md?9==zc?"-":" ":"  ",Ae=Be=0);Ug+=32<=od&&127>od?String.fromCharCode(od):".";nd--}yc&&(yc+="\n");yc+=cb+"  "+Ce+(0==zc?" "+Ug:"")}yc&&a.j(yc);a.sa=kd}}}}break;case "e":if("else"==f[0])break;var pd=1,Vg=255,Wg=a.Ga,Xg=a.bc;"ew"==f[0]&&(pd=2,Vg=65535,Wg=a.Db,Xg=a.Yc);var Yg=pd<<1,Zg=f[1];if(null==Zg)a.j("edit memory commands:"),a.j("\teb [a] [...]  edit bytes at address a"),a.j("\tew [a] [...]  edit words at address a");else{var qd=th(a,Zg);if(qd)for(var rd=2;rd<f.length;rd++){var Ac=Fg(a,
f[rd]);if(void 0===Ac){a.j("unrecognized value: "+f[rd]);break}Ac&~Vg&&a.j("warning: "+q(Ac)+" exceeds "+pd+"-byte value");var fj=Wg.call(a,qd);a.j("changing "+yh(qd)+" from "+q(fj,Yg,!0)+" to "+q(Ac,Yg,!0));Xg.call(a,qd,Ac,pd)}}break;case "f":wi(a,f[1]);break;case "g":a:{var $g=f[1],gj=b;if(void 0!==$g){var De=th(a,$g,!0);if(!De)break a;xh(a,De,gj);a.Oa(a.u,De,!0)}Sh(a,!0)||c||a.j("cpu busy or unavailable, run command ignored")}break;case "h":a:{if(a.flags.ka){var ah="halting";cd(a)}else{if(Xb(a,
!0))break a;ah="already halted"}c||a.j(ah)}break;case "i":if("if"==f[0]){var Bc=b.substr(2);Bc=Na(Bc);if(Fg(a,Bc)){c||a.j("true: "+Bc);var bh=!0}else c||a.j("false: "+Bc),bh=!1;bh||(d=!1);break}if("int"==f[0]){var hj=f[1];if(a.B.O&512){var Ee=Fg(a,hj);if(null==Ee)var Fe=!1;else a.j("requesting interrupt level "+Ee),me(a.B,Ee),Fe=!0}else a.j("interrupts disabled (use rif=1 to enable)"),Fe=!1;Fe||(d=!1);break}var Ge=f[1];if(Ge&&"?"!=Ge){var He=zg(a,Ge);if(void 0!==He){var ij=Ic(a.J,He);a.j(v(He)+": "+
za(ij))}}else a.j("input commands:"),a.j("\ti [p]\tread port [p]"),a.j("warning: port accesses can affect hardware state");break;case "k":var jj=f[0];if("?"==f[1])a.j("stack trace commands:"),a.j("\tk\tshow frame addresses"),a.j("\tks\tshow symbol information");else{var Ie=0,ch=nh(),Cc=nh(a.B.N);for(a.j("stack trace for "+yh(Cc));10>Ie;){for(var Eb=null,kj=256;65536>Cc.M>>>0;){ch.M=a.Db(Cc,2);if(null==Cc.M||!kj--)break;for(var lj=a,sd=ch,dh=null,Dc=sd.M,eh=Dc,Je=1;6>=Je&&Dc;Je++){if(2<Je){sd.M=Dc;
var td=ai(lj,sd);if(0<=td.indexOf("CALL")){var fh=td.indexOf(" ");if(Dc+(td.indexOf(" ",fh+1)-fh-1)/2==eh){dh=td;break}}}Dc--}sd.M=eh;if(Eb=dh)break}if(!Eb||null==Eb)break;var gh=null;if("ks"==jj){var hh=Eb.match(/[0-9A-F]+$/);hh&&(gh=yi(a,hh[0]))}Eb=Ga(Eb,50)+"  ;"+(gh||"stack="+yh(Cc));a.j(Eb);Ie++}Ie||a.j("no return addresses found")}break;case "l":"ln"==f[0]&&yi(a,f[1],!0);break;case "m":a:{var eb,fb=null,ca=f[1];"?"==ca&&(ca=void 0);if(void 0!==ca){var sb=0;if("all"==ca)sb=-1610612993,ca=null;
else if("on"==ca)fb=!0,ca=null;else if("off"==ca)fb=!1,ca=null;else{"keys"==ca&&(ca="key");"kbd"==ca&&(ca="keyboard");for(eb in ic)if(ca==eb){sb=ic[eb];fb=!!(a.ha&sb);break}if(!sb){a.j("unknown message category: "+ca);break a}}if(sb)if("on"==f[2])a.ha|=sb,fb=!0;else if("off"==f[2]&&(a.ha&=~sb,fb=!1,1073741824==sb)){for(var Ke=0;Ke<a.aa.length;Ke++)a.j(a.aa[Ke]);a.aa=[]}}var mj=0,Ec="";for(eb in ic)if(!ca||ca==eb){var nj=!!(a.ha&ic[eb]);if(null===fb||fb==nj)Ec&&(Ec+=","),++mj%10||(Ec+="\n\t"),"key"==
eb&&(eb="keys"),Ec+=eb}void 0===ca&&a.j("message commands:\n\tm [category] [on|off]\tturn categories on/off");a.j((null!==fb?fb?"messages on:  ":"messages off: ":"message categories:\n\t")+(Ec||"none"));ph(a)}break;case "o":var Le=f[1],oj=f[2];if(Le&&"?"!=Le){var Me=zg(a,Le,"port #"),Ne=zg(a,oj);void 0!==Me&&void 0!==Ne&&(Lc(a.J,Me,Ne),a.j(v(Me)+": "+za(Ne)))}else a.j("output commands:"),a.j("\to [p] [b]\twrite byte [b] to port [p]"),a.j("warning: port accesses can affect hardware state");break;case "p":if("print"==
f[0]){Ai(a,b.substr(5));break}var ih="pr"==f[0]?1:0,pj=1+ih;if(a.T)a.j("step in progress");else{var Oe=nh(a.B.u);switch(a.Ga(Oe)){case 205:a.T=pj,vh(Oe,3)}a.T?(a.Oa(a.u,Oe,!0),Sh(a)||(a.S&&a.S.Ya(),a.T=0)):Bi(a,ih?"tr":"t")}break;case "r":if("reset"==b){a.S&&a.S.reset();break}Uh(a,f);break;case "s":zi(a,f);break;case "t":Bi(a,f[0],f[1]);break;case "u":Vh(a,f[1],f[2],8);break;case "v":if("var"==f[0]){xi(a,b.substr(3))||(d=!1);break}a.j("PCx80 version 2.00 ("+a.B.model+",RELEASE"+(gc?",TYPEDARRAYS":
",LONGARRAYS")+")");a.j(Xa());break;case "?":if(f[1]){Ai(a,b.substr(1));break}var Pe="commands:",Qe;for(Qe in Di)Pe+="\n"+Ga(Qe,9)+Di[Qe];ne(a)||(Pe+="\nnote: frequency/history disabled if no exec breakpoints");a.j(Pe);break;default:a.j("unknown command: "+b),d=!1}}}catch(kh){a.j("debugger error: "+(kh.stack||kh.message)),d=!1}return d}function jd(a,b,c){b=a.yb(b,c);for(var d in b)if(!$h(a,b[+d]))return!1;return!0}
var Di={"?":"help/print","a [#]":"assemble","b [#]":"breakpoint",c:"clear output","d [#]":"dump memory","e [#]":"edit memory",f:"frequencies","g [#]":"go [to #]",h:"halt","i [#]":"input port #","if":"eval expression","int [#]":"request interrupt",k:"stack trace",ln:"list nearest symbol(s)",m:"messages","o [#]":"output port #",p:"step over",print:"print expression",r:"dump/set registers",reset:"reset machine",s:"set options","t [#]":"trace","u [#]":"unassemble",v:"print version","var":"assign variable"},
mh=8080,bi=8086,ci="NONE ACI ADC ADD ADI ANA ANI CALL CC CM CNC CNZ CP CPE CPO CZ CMA CMC CMP CPI DAA DAD DCR DCX DI EI HLT IN INR INX JMP JC JM JNC JNZ JP JPE JPO JZ LDA LDAX LHLD LXI MOV MVI NOP ORA ORI OUT PCHL POP PUSH RAL RAR RET RC RM RNC RNZ RP RPE RPO RZ RLC RRC RST SBB SBI SHLD SPHL STA STAX STC SUB SUI XCHG XRA XRI XTHL".split(" "),di="NONE ADC ADC ADD ADD AND AND CALL CALLC CALLS CALLNC CALLNZ CALLNS CALLP CALLNP CALLZ NOT CMC CMP CMP DAA ADD DEC DEC CLI STI HLT IN INC INC JMP JC JS JNC JNZ JNS JP JNP JZ MOV MOV MOV MOV MOV MOV NOP OR OR OUT JMP POP PUSH RCL RCR RET RETC RETS RETNC RETNZ RETNS RETP RETNP RETZ ROL ROR RST SBB SBB MOV MOV MOV MOV STC SUB SUB XCHG XOR XOR XCHG".split(" "),
Dh=0,Eh=1,Fh=2,Gh=3,Hh=4,Ih=5,Jh=6,Ch=7,Kh=8,Lh=9,Mh=10,Nh=11,Oh=12,Ph=13,Qh=14,Ah="B C D E H L M A BC DE HL SP PC PS PSW".split(" "),gi=15,fi=240,pi=3840,hi=61440,ei=0,ki=1,li=2,mi=3,oi=16,Q=32,ni=64,qi=128,R=Ch<<8|oi|ki,S=Dh<<8|oi|ki,U=Eh<<8|oi|ki,V=Fh<<8|oi|ki,W=Gh<<8|oi|ki,X=Hh<<8|oi|ki,Y=Ih<<8|oi|ki,Z=Jh<<8|oi|ki|ni,Ei=Kh<<8|oi|mi,Fi=Lh<<8|oi|mi,Gi=Mh<<8|oi|mi,Hi=Nh<<8|oi|mi,Ii=Qh<<8|oi|mi,ji=4096,ii=8192,P=16384,ri=32768,rh=[[45],[42,Ei,Q],[71,Ei|ni,R|P],[29,Ei],[28,S],[22,S],[44,S,Q],[63],
[45,ri],[21,Gi|P,Ei],[40,R|P,Ei|ni],[23,Ei],[28,U],[22,U],[44,U,Q],[64],[45,ri],[42,Fi,Q],[71,Fi|ni,R|P],[29,Fi],[28,V],[22,V],[44,V,Q],[52],[45,ri],[21,Gi|P,Fi],[40,R|P,Fi|ni],[23,Fi],[28,W],[22,W],[44,W,Q],[53],[45,ri],[42,Gi,Q],[68,51|ni,Gi|P],[29,Gi],[28,X],[22,X],[44,X,Q],[20],[45,ri],[21,Gi|P,Gi],[41,Gi|P,51|ni],[23,Gi],[28,Y],[22,Y],[44,Y,Q],[16,R|P],[45,ri],[42,Hi,Q],[70,51|ni,R|P],[29,Hi],[28,Z],[22,Z],[44,Z,Q],[72],[45,ri],[21,Gi|P,Hi],[39,R|P,51|ni],[23,Hi],[28,R],[22,R],[44,R,Q],[17],
[43,S,S],[43,S,U],[43,S,V],[43,S,W],[43,S,X],[43,S,Y],[43,S,Z],[43,S,R],[43,U,S],[43,U,U],[43,U,V],[43,U,W],[43,U,X],[43,U,Y],[43,U,Z],[43,U,R],[43,V,S],[43,V,U],[43,V,V],[43,V,W],[43,V,X],[43,V,Y],[43,V,Z],[43,V,R],[43,W,S],[43,W,U],[43,W,V],[43,W,W],[43,W,X],[43,W,Y],[43,W,Z],[43,W,R],[43,X,S],[43,X,U],[43,X,V],[43,X,W],[43,X,X],[43,X,Y],[43,X,Z],[43,X,R],[43,Y,S],[43,Y,U],[43,Y,V],[43,Y,W],[43,Y,X],[43,Y,Y],[43,Y,Z],[43,Y,R],[43,Z,S],[43,Z,U],[43,Z,V],[43,Z,W],[43,Z,X],[43,Z,Y],[26],[43,Z,R],[43,
R,S],[43,R,U],[43,R,V],[43,R,W],[43,R,X],[43,R,Y],[43,R,Z],[43,R,R],[3,R|P,S],[3,R|P,U],[3,R|P,V],[3,R|P,W],[3,R|P,X],[3,R|P,Y],[3,R|P,Z],[3,R|P,R],[2,R|P,S],[2,R|P,U],[2,R|P,V],[2,R|P,W],[2,R|P,X],[2,R|P,Y],[2,R|P,Z],[2,R|P,R],[73,R|P,S],[73,R|P,U],[73,R|P,V],[73,R|P,W],[73,R|P,X],[73,R|P,Y],[73,R|P,Z],[73,R|P,R],[66,R|P,S],[66,R|P,U],[66,R|P,V],[66,R|P,W],[66,R|P,X],[66,R|P,Y],[66,R|P,Z],[66,R|P,R],[5,R|P,S],[5,R|P,U],[5,R|P,V],[5,R|P,W],[5,R|P,X],[5,R|P,Y],[5,R|P,Z],[5,R|P,R],[76,R|P,S],[76,R|
P,U],[76,R|P,V],[76,R|P,W],[76,R|P,X],[76,R|P,Y],[76,R|P,Z],[76,R|P,R],[46,R|P,S],[46,R|P,U],[46,R|P,V],[46,R|P,W],[46,R|P,X],[46,R|P,Y],[46,R|P,Z],[46,R|P,R],[18,R|P,S],[18,R|P,U],[18,R|P,V],[18,R|P,W],[18,R|P,X],[18,R|P,Y],[18,R|P,Z],[18,R|P,R],[58],[50,Ei],[34,51],[30,51],[11,51],[51,Ei],[4,R|P,Q|ki],[65,qi],[62],[54],[38,51],[30,51|ri],[15,51],[7,51],[1,R|P,Q|ki],[65,qi],[57],[50,Fi],[33,51],[48,Q|ki,R|P],[10,51],[51,Fi],[74,R|P,Q|ki],[65,qi],[55],[54,ri],[31,51],[27,R|P,Q|ki],[8,51],[7,51|ri],
[67,R|P,Q|ki],[65,qi],[61],[50,Gi],[37,51],[78,Hi|ni|P,Gi|P],[14,51],[51,Gi],[6,R|P,Q|ki],[65,qi],[60],[49,Gi],[36,51],[75,Gi|P,Fi|P],[13,51],[7,51|ri],[77,R|P,Q|ki],[65,qi],[59],[50,Ii],[35,51],[24],[12,51],[51,Ii],[47,R|P,Q|ki],[65,qi],[56],[69,Hi|P,Gi|P],[32,51],[25],[9,51],[7,51|ri],[19,R|P,Q|ki],[65,qi]],Rh=1E3;nb(function(){for(var a=Ib(document,"pcx80","debugger"),b=0;b<a.length;b++){var c=a[b],d=Jb(c);d=new lh(d);Hb(d,c)}});
function Ji(a,b,c){x.call(this,"Computer",a,16384);this.flags.ja=!1;Ki(this,b);this.N=fd(this,"autoPower",a);this.u=0;this.V=a.busWidth||a.buswidth;this.g=Li;this.I=null;this.G=this.T=!1;this.url=fd(this,"url")||"";(Math.random()+.1).toString(36);this.i=Mi(this);if(this.B=Mb("CPU",this.id)){this.L=Mb("Debugger",this.id);this.C=[];for(b=null;b=kc(this,"Video",b);)this.C.push(b);this.J=new mc({id:this.Ra+".bus",busWidth:this.V},this.B,this.L);var d=Kb(this.id);if(this.D=(this.F=Mb("Panel",this.id))&&
this.F.R.print)for(b=0;b<d.length;b++){var e=d[b];e.ba=this.F.ba;e.print=this.F.print;e.j=this.F.j}this.j("PCx80 v2.00\nCopyright \u00a9 2012-2022 Jeff Parsons <Jeff@pcjs.org>\nLicense: MIT <https://www.pcjs.org/LICENSE.txt>");for(b=0;b<d.length;b++)e=d[b],e.Fa&&e.Fa(this,this.J,this.B,this.L);b=null;e=fd(this,"resume",a);void 0!==e&&(1<e.length?b=this.H=e:this.g=parseInt(e,10));e=!1;d=fd(this,"state");d||(e=!0,d=a.state);d&&(b=this.O=d,e||(this.G=!0,this.g=Li),this.g&&(this.K=new Pd(this,"2.00"),
this.K.load()?b=null:delete this.K));!b&&this.g&&(b=Ni(this))&&(this.G=!0);if(b){var f=this;Ta(b,null,!0,function(g,h,k){k?(f.H=null,f.G=!1,f.ba("Unable to load machine state from server (error "+k+(h?": "+Na(h):"")+")")):(f.I=h,f.T=!0);Wb(f)})}else Wb(this);this.R.power||(this.N=!0);!c&&this.N&&this.wait(this.lb)}else w("Unable to find CPU component")}ra(Ji,x);
function Ki(a,b){if(!b){var c;if("object"==typeof resources&&(c=resources.parms))try{b=eval("("+c+")")}catch(d){w(d.message+" ("+c+")")}}a.U=b}function fd(a,b,c){var d=b.toLowerCase();d=ib(b)||ib(d);void 0===d&&a.U&&(d=a.U[b]);void 0===d&&c&&(d=c[b]);void 0===d&&"object"==typeof resources&&resources[b]&&(d=b);return d}l=Ji.prototype;l.wait=function(a,b){for(var c=this,d=Kb(this.id),e=0;e<=d.length;e++){var f=e<d.length?d[e]:this;if(!Vb(f)){Vb(f,function(){c.wait(a,b)});return}}a.call(this,b)};
function Oi(a,b){var c=new Pd(a,"2.00",Pi);if(c.load()&&Qi(c)){var d=c.get(Ri),e=b?b.get(Ri):"unknown";d!=e&&(a.ba("Machine state may be out-of-date\n("+d+" vs. "+e+")\nCheck your browser's local storage limits"),b||c.clear())}}
l.lb=function(a){void 0===a&&(a=this.g||(this.I?Si:Li));if(!this.u){this.u++;var b=!1,c=!1;this.P=!1;var d=this.K||new Pd(this,"2.00");if(a==Ti)b=!0;else if(a>Li){if(d.load(this.I)){this.A=new Pd(this,"2.00",Ui);this.A.load()&&(Vi(),a=Wi,Xi(this.A));this.A.set(Ri,Ia("%T",new Date));this.A.store();var e=this.g&&!this.G;if(a==Si||Fb("Click OK to restore the previous PCx80 machine state, or CANCEL to reset the machine.")){if(c=Qi(d)){var f=d.get("code"),g=d.get("data");f&&("ok"==f?d.load(g):("error"==
f&&"no machine state"!=g?(this.ba("Error: "+g),"unable to verify user"==g&&(ab(Yi,""),this.i=null)):this.j(f+": "+g),Xi(d),d.load()?(c=Qi(d),e=!0):c=!1))}e&&Oi(this,c?d:null)}else a==Wi&&d.clear()}else Oi(this);delete this.I;delete this.K}e=Kb(this.id);for(f=0;f<e.length;f++)g=e[f],g!==this&&g!=this.B&&(c=Zi(this,g,d,b,c));b=[d,a,c];a!=Ti?this.wait(this.Dc,b):this.Dc(b)}};
function Zi(a,b,c,d,e){if(!b.flags.ja){b.flags.ja=!0;if(b.va){var f=null;e&&((f=c.get(b.id))||(f=c.get(b.id.replace(/-[0-9]+\./i,"."))));"string"===typeof f&&(f=null);!b.va(f,d)&&f&&(w("Unable to restore state for "+b.type),a.O&&!a.T?(c.clear(),a.g=Li,window&&window.location.reload()):a.P=!0,b.va(null),e=!1)}if(!d&&b.wc)for(a=b.wc.split("|"),c=0;c<a.length;c++)b.status(a[c])}return e}
l.Dc=function(a){var b=a[0],c=0>a[1];a=a[2];this.X=!0;this.flags.ja=!0;var d=this.R.power;d&&(d.textContent="Shutdown");this.B&&(Zi(this,this.B,b,c,a),this.B.ib());this.P&&(Vi(),b.clear());!c&&this.A&&(this.A.clear(),delete this.A);this.u=0};function Vi(){pb("There may be a problem with your PCx80 machine.")}
function Ci(a,b,c){var d="none";if(a.u)return null;a.u--;var e=new Pd(a,"2.00"),f=new Pd(a,"2.00",Pi),g=Ia("%T",new Date);f.set(Ri,g);e.set(Ri,g);e.set($i,"2.00");e.set(aj,window?window.location.href:null);e.set(bj,Xa());if(a.B&&a.B.ua){c&&xd(a.B);var h=a.B.ua(b,c);"object"===typeof h&&e.set(a.B.id,h);c&&(a.B.flags.ja=!1,!1===h&&(d=null))}g=Kb(a.id);for(var k=0;k<g.length;k++){var m=g[k];m.flags.ja&&(m.ua&&(h=m.ua(b,c),"object"===typeof h&&e.set(m.id,h)),c&&(m.flags.ja=!1,!1===h&&(d=null)))}d&&(c?
(g=h=!1,b?(a.i&&qj(a,a.i,e.toString()),f.store()&&e.store()||(d=null,h=g=!0)):a.g&&(h=!0,g=a.g==rj),h&&e.clear(g)):d=e.toString());c&&(a.flags.ja=!1,b=a.R.power)&&(b.textContent="Power");a.u=0;return d}l.reset=function(){this.J&&this.J.reset&&(ec(this,"Resetting "+this.J.type),this.J.reset());for(var a=Kb(this.id),b=0;b<a.length;b++){var c=a[b];c!==this&&c!==this.J&&c.reset&&(ec(this,"Resetting "+c.type),c.reset())}};
l.start=function(a,b){for(var c=Kb(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.start&&e.start(a,b)}};l.stop=function(a,b){for(var c=Kb(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.stop&&e.stop(a,b)}};
l.ea=function(a,b,c){var d=this;switch(b){case "power":return this.R[b]=c,c.onclick=function(){d.u||(d.flags.ja?Ci(d,!1,!0):d.wait(d.lb))},!0;case "reset":return this.R[b]=c,c.onclick=function(){if(d.flags.ja&&!d.u)if(d.g&&!d.H){var e=Fb("Click OK to save changes to this PCx80 machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");Ci(d,e,!0);!e&&d.O?window&&window.location.reload():d.lb(Li)}else d.reset(),d.B&&d.B.ib()},!0;case "save":if(Da())c.parentNode.removeChild(c);else return this.R[b]=
c,c.onclick=function(){var e=Mi(d,!0);if(e){var f=!!(d.g&&!d.H||d.O),g=Ci(d,f);f?qj(d,e,g):d.ba("Resume disabled, machine state not saved")}},!0}return!1};
function Mi(a,b){var c=a.i;c||((c=$a(Yi),void 0!==c)?!c&&b&&(b=null,window&&(b=window.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),c=b)&&((c=sj(a,c))||a.ba("The user ID is invalid.")):b&&a.ba("Browser local storage is not available"));return c}
function sj(a,b){a.i=null;b=Ta(Va()+"/api/v1/user?req=verify&user="+b);var c=b[1];if(!b[0]&&c)try{b=eval("("+c+")"),b.code&&"ok"==b.code&&(ab(Yi,b.data),a.i=b.data)}catch(d){w(d.message+" ("+c+")")}return a.i}function Ni(a){var b=null;a.i&&(b=Va()+"/api/v1/user?req=load&user="+a.i+"&state="+tj(a,"2.00"));return b}
function qj(a,b,c){if(c){var d={req:"store"};d.user=b;d.state=tj(a,"2.00");d.data=c;b=Ta(Va()+"/api/v1/user",d);d=b[0];if(b[1]){if(d){var e=d.indexOf("\n");0<e&&(d=d.substr(0,e));d.indexOf("Error: ")||(d=d.substr(7))}d='{"code":'+b[1]+',"data":"'+d+'"}'}b=JSON.parse(d);b&&"ok"==b.code?a.ba("Machine state saved to server"):c&&(c=b&&b.data||"unable to save machine state",c="error"==b.code?"Error: "+c:"Error "+b.code+": "+c,a.ba(c),ab(Yi,""),a.i=null)}}
function kc(a,b,c){a=Kb(a.id);for(var d=0;d<a.length;d++){var e=a[d];if(c)c==e&&(c=null);else if(e.type==b)return e}return null}l.Ya=function(a){if(this.C.length){var b=0,c=0;!a&&window&&(b=window.scrollX,c=window.scrollY);var d=this.C[0];d.W&&d.W.focus();!a&&window&&window.scrollTo(b,c)}};
function Fd(a,b){a.B&&(a=a.B,a.fb&&(b||!a.flags.ka||a.flags.Cc)&&(K(a,"A",a.i),K(a,"B",a.A),K(a,"C",a.C),K(a,"BC",Qd(a),4),K(a,"D",a.D),K(a,"E",a.F),K(a,"DE",Sd(a),4),K(a,"H",a.G),K(a,"L",a.H),K(a,"HL",E(a),4),K(a,"SP",a.N,4),K(a,"PC",a.u,4),b=Od(a),K(a,"PS",b,4),K(a,"IF",b&512?1:0,1),K(a,"SF",b&128?1:0,1),K(a,"ZF",b&64?1:0,1),K(a,"AF",b&16?1:0,1),K(a,"PF",b&4?1:0,1),K(a,"CF",b&1?1:0,1)),b=a.R.speed)&&(b.textContent=a.flags.ka&&a.Z?a.Z.toFixed(2)+"Mhz":"Stopped")}
var Ui="failsafe",Pi="validate",Ri="timestamp",$i="version",aj="url",bj="browser",Yi="user",Ti=-1,Li=0,Si=1,Wi=2,rj=3;nb(function(){for(var a=Ib(document,"pcx80-machine"),b=0;b<a.length;b++){var c=a[b],d=Jb(c);c=Ib(c,"pcx80","computer");for(var e=0;e<c.length;e++){var f=c[e],g=Jb(f);g=new Ji(g,d,!0);Hb(g,f);g.N&&g.wait(g.lb)}}});ob.show.push(function(){for(var a=Ib(document,"pcx80","computer"),b=0;b<a.length;b++){var c=Jb(a[b]);if(c=Mb("Computer",c.id))c.flags.Pb=!1,c.X&&!c.flags.ja&&c.lb(Ti)}});
ob.exit.push(function(){for(var a=Ib(document,"pcx80","computer"),b=0;b<a.length;b++){var c=Jb(a[b]);if(c=Mb("Computer",c.id))c.flags.Pb=!0,c.flags.ja&&Ci(c,!(!c.g||c.H),!0)}});function Pd(a,b,c){this.id=a.id;this.L=a.L;this.i="";this.g={};this.B=this.J=!1;this.key=tj(a,b,c);Xi(this,a.Ad)}l=Pd.prototype;l.set=function(a,b){try{this.g[a]=b}catch(c){}};l.get=function(a){return this.g[a]||null};l.data=function(){return this.g};
l.load=function(a){return a?(this.i=a,this.B=!0,this.J=!1,!0):this.B?!0:Ya()&&(a=$a(this.key))?(this.i=a,this.B=!0):!1};function Qi(a){var b=!0;if(!a.J)try{a.g=JSON.parse(a.i),a.J=!0}catch(c){w(c.message||c),b=!1}return b}l.store=function(){var a=!0;if(Ya()){var b=JSON.stringify(this.g);ab(this.key,b)||(w("Unable to store "+b.length+" bytes in browser local storage"),a=!1)}return a};l.toString=function(){return this.g?JSON.stringify(this.g):this.i};
function Xi(a,b){a.i="";a.g={};a.B=a.J=!1;b&&a.set("parms",b)}l.clear=function(a){Xi(this);var b=[];try{for(var c=0,d=window.localStorage.length;c<d;c++)b.push(window.localStorage.key(c))}catch(e){}for(c=0;c<b.length;c++)if((d=b[c])&&(a||d.substr(0,this.key.length)==this.key)){try{window.localStorage.removeItem(d)}catch(e){}b.splice(c,1);c=0}};function tj(a,b,c){a=a.id;if(b){var d=b.indexOf(".");0<d&&(a+=".v"+b.substr(0,d))}c&&(a+="."+c);return a}var uj=0;
function vj(a,b,c,d,e,f,g,h){g("Loading "+a+"...");Ta(a,null,!0,function(k,m,n){n?(m||(m="unable to load "+a+" ("+n+")"),h(k,m,null)):wj(m,a,b,c,d,e,f,g,h)})}
function wj(a,b,c,d,e,f,g,h,k){function m(n,r,u){if(u)k(n,u,null);else{c&&(Ab(c,b,r),(u=b)&&0>u.indexOf("/")&&"/"==window.location.pathname.slice(-1)&&(u=window.location.pathname+u),e?"}"==e.slice(-1)?(e=e.slice(0,-1),1<e.length&&(e+=",")):e='{state:"'+e+'",':e="{",e+='url:"'+u+'"}',"object"==typeof resources&&(u=null),e=e.replace(/\$/g,"$$$$").replace(/'/g,"&apos;"),f&&(n=r.match(/(<machine[^>]*\sclass=)(['"])(.*?)(\2[^>]*>)/))&&(r=r.replace(n[0],n[1]+n[2]+f+n[4]),f=""),(n=r.match(/(<machine[^>]*\sdebugger=)(['"])(available)(\2[^>]*>)/))&&
(r=r.replace(n[0],n[1]+n[2]+"optional"+n[4])),r=r.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+c+"$2"+(f?' class="'+f+'"':"")+(e?" parms='"+e+"'":"")+(u?' url="'+u+'"':"")));g||(r=r.replace(/(<xsl:variable name="APPNAME">).*?(<\/xsl:variable>)/,"$1PCx80$2"),r=r.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1"+d+"$2"),r=r.replace(/<xsl:variable name="APPVERSION"(\/>|>[^<]*<\/xsl:variable>)/,'<xsl:variable name="APPVERSION">2.00</xsl:variable>'));n=null;if("<"==r.charAt(0))try{g||
(r=r.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(n=new window.ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.loadXML(r)):n=(new window.DOMParser).parseFromString(r,"text/xml")}catch(t){n=null,r=t.message}else r="unrecognized XML: "+(255<r.length?r.substr(0,255)+"...":r);k(b,r,n)}}a?g?xj(b,a,h,m):m(b,a,""):k(b,"no data",null)}
function xj(a,b,c,d){var e;if(e=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(b)){var f=e[2];c("Loading "+f+"...");Ta(f,null,!0,function(g,h,k){if(k||!h)d(g,b,"unable to resolve XML reference: "+e[0]+" ("+k+")");else{if(k=e[3]){var m=h.match(new RegExp("<"+e[1]+"[^>]*>"));if(m){for(var n=m[0],r,u=/( [a-z]+=)(['"])(.*?)\2/gi;r=u.exec(k);)n=0>n.toLowerCase().indexOf(r[1].toLowerCase())?n.replace(">",r[0]+">"):n.replace(new RegExp(r[1]+"(['\"])(.*?)\\1"),r[0]);m[0]!=n&&(h=h.replace(m[0],n))}else{d(g,b,"missing <"+
e[1]+"> in "+f);return}}h=h.replace(/<\?xml[^>]*>[\r\n]*/,"");b=b.replace(e[0],h);xj(g,b,c,d)}})}else d(a,b,"")}
function yj(a,b,c,d,e){function f(z){if(void 0===n){var B=m&&Ib(m,"machine-warning");n=B&&B[0]||m}n&&(n.innerHTML=Ea(z))}function g(z,B){if("string"==typeof B&&0<=B.indexOf("<!DOCTYPE html>")){var ea=B.match(/<title>(?:PCjs: |)(.*?)<\/title>/);ea&&(B=ea[1])}f("Error: "+B+(z?" ("+z+")":""));r&&h();r=!1}function h(){--uj||vb(!0)}var k="pcx80",m,n,r=!0;uj++;Bb[a]={};if(!b)return d&&Ab(a,"parms",d),h(),r;"true"==ib("debugger")&&0>b.indexOf("/debugger")&&(b=b.replace("/machine.xml","/debugger/machine.xml"));
try{if(m=document.getElementById(a)){var u;if("object"==typeof resources&&(u=resources.css)){var t=document.head||document.getElementsByTagName("head")[0],y=document.createElement("style");y.type="text/css";y.styleSheet?y.styleSheet.cssText=u:y.appendChild(document.createTextNode(u));t.appendChild(y)}c||(c="/machines/"+k+"/xsl/components.xsl");k=k.split("/").pop();u=function(z,B,ea){ea?vj(c||"","",k,"","",!1,f,function(F,ma,T){if(T)if(Ab(a,c||"",ma),f("Processing "+b+"..."),window.ActiveXObject||
"ActiveXObject"in window)(T=ea.transformNode(T))?(m.outerHTML=T,h()):g(F,"transformNodeToObject failed");else if(document.implementation&&document.implementation.createDocument)if(ma=new XSLTProcessor,ma.importStylesheet(T),T=ma.transformToFragment(ea,document))if(ma=m.parentNode){var ia=F=0,Oa=m.getBoundingClientRect();0>Oa.bottom&&(F=window.scrollX,ia=window.scrollY);ma.replaceChild(T,m);(m=document.getElementById(a))&&0>Oa.bottom&&(T=m.getBoundingClientRect(),ia=window.performance&&window.performance.navigation.type==
window.performance.navigation.TYPE_RELOAD?0:ia+Math.ceil(T.height-Oa.height),window.scrollTo(F,ia));h()}else g(F,"invalid machine element: "+a);else g(F,"transformToFragment failed");else g(F,"unable to transform XML: unsupported browser");else g(F,ma)}):g(z,B)};"<"!=b.charAt(0)?vj(b,a,k,d||"",e||"",!0,f,u):wj(b,"",a,k,d||"",e||"",!1,f,u)}else g(b,"missing machine element: "+a)}catch(z){g(b,z.message)}return r}window.embedPCx80=function(a,b,c,d,e){vb(!1);return yj(a,b,c,d,e)};
window.commandMachine=function(a,b,c,d,e,f){if("script"==e){d=!1;c+=".machine";if(!f)delete Ob[c],d=!0;else if("string"==typeof f&&!Ob[c]){d=!0;e=Ob;for(var g=c,h=f.length,k=[],m=[],n="",r=null,u=0;u<h;u++){var t=f[u];if('"'==t||"'"==t)r&&t!=r?n+=t:(r?r=null:r=t,n&&(m.push(n),n=""));else{if(!r){if("\r"==t||"\n"==t)t=";";if(" "==t||"\t"==t||";"==t){n&&(m.push(n),n="");";"==t&&m.length&&(k.push(m),m=[]);continue}}n+=t}}n&&m.push(n);m.length&&k.push(m);e[g]=k;Nb(c)||(d=!1)}return d?(b&&(a.disabled=!0),
!0):!1}if(d&&(g=Mb(d,c+".machine"))&&(h=g.exports)&&(h=h[e]))return h.call(g,f)?(b&&(a.disabled=!0),!0):!1;console.log("unimplemented: commandMachine('"+c+"','"+d+"','"+e+"','"+f+"')");return!1};window.enableEvents=vb;window.sendEvent=xb;})()

//# sourceMappingURL=pcx80.js.map
